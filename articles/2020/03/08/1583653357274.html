<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="theme-color" content="#3b3e43"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"/><title>Spring 学习笔记 - 雨羊的个人博客</title><meta name="description" content="A small and beautiful blogging system. 一款小而美的博客系统。"/><meta property="og:description" content="A small and beautiful blogging system. 一款小而美的博客系统。"/>    <meta name="keywords" content="雨羊,yuyang,Rainsheep,rainsheep,杨珑奇,yanglongqi"/><link rel="dns-prefetch" href="https://cdn.jsdelivr.net/gh/88250/solo/src/main/resources"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://cdn.jsdelivr.net/gh/88250/solo/src/main/resources"><link rel="icon" type="image/png" href="https://static.b3log.org/images/brand/solo-32.png"/><link rel="apple-touch-icon" href="https://static.b3log.org/images/brand/solo-32.png"><link rel="shortcut icon" type="image/x-icon" href="https://static.b3log.org/images/brand/solo-32.png"><meta name="copyright" content="B3log"/><meta http-equiv="Window-target" content="_top"/><meta property="og:locale" content="zh_CN"/><meta property="og:title" content="Spring 学习笔记 - 雨羊的个人博客"/><meta property="og:site_name" content="雨羊的个人博客"/><meta property="og:url"      content="https://Rainsheep.github.io/articles/2020/03/08/1583653357274.html?"/><meta property="og:image" content="https://static.b3log.org/images/brand/solo-32.png"/><link rel="search" type="application/opensearchdescription+xml" title="Spring 学习笔记 - 雨羊的个人博客" href="/opensearch.xml"><link href="https://Rainsheep.github.io/rss.xml" title="RSS" type="application/rss+xml" rel="alternate"/><link rel="manifest" href="https://Rainsheep.github.io/manifest.json">        <link rel="canonical" href="https://Rainsheep.github.io/articles/2020/03/08/1583653357274.html">        <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/gh/88250/solo/src/main/resources/skins/nijigen/css/base.css?1584471619574"/>
            <link rel="prev" title="mybatis 学习笔记" href="https://Rainsheep.github.io/articles/2020/03/06/1583434614785.html">
            <link rel="next" title="Linux 学习笔记" href="https://Rainsheep.github.io/articles/2020/03/09/1583763466425.html">
    </head>
<body>
<div class="bg"></div>
<div class="bg bg--1"></div>
<div class="bg bg--2"></div>
<div class="bg bg--3"></div>
<div class="bg bg--4"></div>
<div class="bg bg--5"></div>
<header class="header">
    <div class="header__wrap">
        <a href="https://Rainsheep.github.io" rel="start" class="header__logo">
            <i class="icon__home"></i> 雨羊的个人博客
        </a>

        <nav class="mobile__hidden header__nav">
                <a href="/my-github-repos" target="_self" rel="section">
                    <img class="page-icon" src="/images/github-icon.png" alt="我的开源">我的开源
                </a>
            <a href="https://Rainsheep.github.io/tags.html" rel="section">
                <i class="icon__tags"></i> 标签墙
            </a>
            <a href="https://Rainsheep.github.io/archives.html">
                <i class="icon__inbox"></i> 存档
            </a>
            <a rel="archive" href="https://Rainsheep.github.io/links.html">
                <i class="icon__link"></i> 友情链接
            </a>
            <a rel="alternate" href="https://Rainsheep.github.io/rss.xml" rel="section">
                <i class="icon__rss"></i> RSS
            </a>
        </nav>

    </div>
</header>
<div class="header__m fn__none">
    <i class="icon__list fn__none" onclick="$(this).next().slideToggle()"></i>
    <main class="module__list fn__none"></main>
    <i class="icon__more" onclick="$(this).next().slideToggle()"></i>
    <main class="module__list">
        <ul>
                <li>
                    <a href="/my-github-repos" target="_self" rel="section">
                        <img class="page-icon" src="/images/github-icon.png" alt="我的开源">我的开源
                    </a>
                </li>
            <li>
                <a href="https://Rainsheep.github.io/tags.html" rel="section">
                    <i class="icon__tags"></i> 标签墙
                </a>
            </li>
            <li>
                <a href="https://Rainsheep.github.io/archives.html">
                    <i class="icon__inbox"></i> 存档
                </a>
            </li>
            <li>
                <a rel="archive" href="https://Rainsheep.github.io/links.html">
                    <i class="icon__link"></i> 友情链接
                </a>
            </li>
            <li>
                <a rel="alternate" href="https://Rainsheep.github.io/rss.xml" rel="section">
                    <i class="icon__rss"></i> RSS
                </a>
            </li>
        </ul>
    </main>
</div>
<div class="main" id="pjax">
    
    <div class="content">
        <main id="articlePage">
            <div class="article-list">
                <div class="item item--active">
                    <time class="vditor-tooltipped vditor-tooltipped__n item__date"
                          aria-label="2020年">
                        03月
                        <span class="item__day">08</span>
                    </time>

                    <h2 class="item__title">
                        <a rel="bookmark" href="https://Rainsheep.github.io/articles/2020/03/08/1583653357274.html">
                            Spring 学习笔记
                        </a>
                    </h2>

                    <div class="item__date--m fn__none">
                        <i class="icon__date"></i>
                        2020-03-08
                    </div>

                    <div class="ft__center">
                        <span class="tag">
                            <i class="icon__tags"></i>
                            <a rel="tag" href="https://Rainsheep.github.io/tags/Java">
                                Java</a>,
                            <a rel="tag" href="https://Rainsheep.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">
                                学习笔记</a>
                        </span>
                            <a class="tag" href="https://Rainsheep.github.io/articles/2020/03/08/1583653357274.html#b3logsolocomments">
                                <i class="icon__comments"></i> <span data-uvstatcmt="1583653357274">0</span> 评论
                            </a>
                        <span class="tag">
                            <i class="icon__views"></i>
                        <span data-uvstaturl="https://Rainsheep.github.io/articles/2020/03/08/1583653357274.html">0</span> 浏览
                        </span>
                    </div>

                    <div class="vditor-reset">
                        <h3 id="1--Spring-框架了解">1. Spring 框架了解</h3>
<ul>
<li>Spring 是分层的 Java SE/EE 应用 full-stack 轻量级开源框架，以 IoC（Inverse Of Control：反转控制）和 AOP（Aspect Oriented Programming：面向切面编程）为内核，提供了展现层 Spring MVC 和持久层 Spring JDBC 以及业务层事务管理等众多的企业级应用技术，还能整合开源世界众多著名的第三方框架和类库，逐渐成为使用最多的 Java EE 企业应用开源框架。</li>
<li>Spring 的优势
<ul>
<li>方便解耦，简化开发<br>
通过 Spring 提供的 IoC 容器，可以将对象间的依赖关系交由 Spring 进行控制，避免硬编码所造成的过度程序耦合。用户也不必再为单例模式类、属性文件解析等这些很底层的需求编写代码，可以更专注于上层的应用。</li>
<li>AOP 编程的支持<br>
通过 Spring 的 AOP 功能，方便进行面向切面的编程，许多不容易用传统 OOP 实现的功能可以通过 AOP 轻松应付。</li>
<li>声明式事务的支持<br>
可以将我们从单调烦闷的事务管理代码中解脱出来，通过声明式方式灵活的进行事务的管理，提高开发效率和质量。</li>
<li>方便程序的测试<br>
可以用非容器依赖的编程方式进行几乎所有的测试工作，测试不再是昂贵的操作，而是随手可做的事情</li>
<li>方便集成各种优秀框架<br>
Spring 可以降低各种框架的使用难度，提供了对各种优秀框架（Struts、Hibernate、Hessian、Quartz<br>
等）的直接支持。</li>
<li>降低 JavaEE API 的使用难度<br>
Spring 对 JavaEE API（如 JDBC、JavaMail、远程调用等）进行了薄薄的封装层，使这些 API 的使用难度降低。</li>
<li>源码是经典学习范例<br>
Spring 的源代码设计精妙、结构清晰、匠心独用，处处体现着大师对 Java 设计模式灵活运用以及对 Java 技术的高深造诣。它的源代码无意是 Java 技术的最佳实践的范例。</li>
</ul>
</li>
<li>Spring 的体系结构<img src="https://raw.githubusercontent.com/Rainsheep/pic-bed/master/img/2020-03-06+15:46:26+spring-overview.png" alt=""></li>
</ul>
<h3 id="2--工厂模式解耦">2. 工厂模式解耦</h3>
<ul>
<li>
<p>Bean：有可重用组件的含义。</p>
</li>
<li>
<p>JavaBean：用 Java 语言编写的可重用组件，javabean &gt; 实体类</p>
</li>
<li>
<p>工厂模式：一个创建 Bean 对象的工程，是创建 service 和 dao 的对象的。</p>
</li>
<li>
<p>工厂模式解耦：</p>
<ul>
<li>需要一个配置文件来配置 service 和 dao，配置内容：唯一标识 = 全限定类名(key=value)</li>
<li>通过读取配置文件中的内容，反射创建对象，避免通过 new 关键字来达到解耦。</li>
</ul>
</li>
<li>
<p>解耦例子：<br>
bean.properties，定义接口所对应的实现类的全类名</p>
<pre><code class="highlight-chroma">accountService=pers.ylq.service.impl.AccountServiceImpl
accountDao=pers.ylq.dao.impl.AccountDaoImpl
</code></pre>
<p>创建工厂类，根据接口名字返回实现类对象</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-kn">package</span> <span class="highlight-nn">pers.ylq.factory</span><span class="highlight-o">;</span>

<span class="highlight-kn">import</span> <span class="highlight-nn">java.io.InputStream</span><span class="highlight-o">;</span>
<span class="highlight-kn">import</span> <span class="highlight-nn">java.util.Properties</span><span class="highlight-o">;</span>

<span class="highlight-kd">public</span> <span class="highlight-kd">class</span> <span class="highlight-nc">BeanFactory</span> <span class="highlight-o">{</span>
    <span class="highlight-kd">private</span> <span class="highlight-kd">static</span> <span class="highlight-n">Properties</span> <span class="highlight-n">props</span><span class="highlight-o">;</span>

    <span class="highlight-kd">static</span> <span class="highlight-o">{</span>
        <span class="highlight-k">try</span> <span class="highlight-o">{</span>
            <span class="highlight-n">props</span> <span class="highlight-o">=</span> <span class="highlight-k">new</span> <span class="highlight-n">Properties</span><span class="highlight-o">();</span>
            <span class="highlight-n">InputStream</span> <span class="highlight-n">is</span> <span class="highlight-o">=</span> <span class="highlight-n">BeanFactory</span><span class="highlight-o">.</span><span class="highlight-na">class</span><span class="highlight-o">.</span><span class="highlight-na">getClassLoader</span><span class="highlight-o">().</span><span class="highlight-na">getResourceAsStream</span><span class="highlight-o">(</span><span class="highlight-s">"bean.properties"</span><span class="highlight-o">);</span>
            <span class="highlight-n">props</span><span class="highlight-o">.</span><span class="highlight-na">load</span><span class="highlight-o">(</span><span class="highlight-n">is</span><span class="highlight-o">);</span>
        <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Exception</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
            <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">ExceptionInInitializerError</span><span class="highlight-o">(</span><span class="highlight-s">"初始化properties失败！"</span><span class="highlight-o">);</span>
        <span class="highlight-o">}</span>
    <span class="highlight-o">}</span>

    <span class="highlight-kd">public</span> <span class="highlight-kd">static</span> <span class="highlight-n">Object</span> <span class="highlight-nf">getBean</span><span class="highlight-o">(</span><span class="highlight-n">String</span> <span class="highlight-n">beanName</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
        <span class="highlight-n">Object</span> <span class="highlight-n">bean</span> <span class="highlight-o">=</span> <span class="highlight-kc">null</span><span class="highlight-o">;</span>
        <span class="highlight-n">String</span> <span class="highlight-n">beanPath</span> <span class="highlight-o">=</span> <span class="highlight-n">props</span><span class="highlight-o">.</span><span class="highlight-na">getProperty</span><span class="highlight-o">(</span><span class="highlight-n">beanName</span><span class="highlight-o">);</span>
        <span class="highlight-k">try</span> <span class="highlight-o">{</span>
            <span class="highlight-n">bean</span> <span class="highlight-o">=</span> <span class="highlight-n">Class</span><span class="highlight-o">.</span><span class="highlight-na">forName</span><span class="highlight-o">(</span><span class="highlight-n">beanPath</span><span class="highlight-o">).</span><span class="highlight-na">newInstance</span><span class="highlight-o">();</span>
        <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Exception</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
        <span class="highlight-o">}</span>
        <span class="highlight-k">return</span> <span class="highlight-n">bean</span><span class="highlight-o">;</span>
    <span class="highlight-o">}</span>
<span class="highlight-o">}</span>
</code></pre>
<p>在 service 中利用以下语句获取对象：<br>
<code>private IAccountDao accountDao = (IAccountDao) BeanFactory.getBean("accountDao");</code><br>
代替以前的<br>
<code>private IAccountDao accountDao = new AccountDaoImpl();</code><br>
servlet 中同理用工厂获取 service 实现类对象。<br>
这样，即使实现类对象不存在，在编译期程序也不会报错，运行才报错，达到了解耦的目的。</p>
</li>
<li>
<p>上面例子存在的问题：</p>
<ul>
<li>每调用一次都会创建一个新的对象，是多例的。</li>
<li>多例不存在线程安全问题，因为每个用户的对象都不同，不会去访问同一个资源。</li>
<li>单例存在线程安全问题，多个用户使用同一个对象，去访问成员变量时就会出现问题。</li>
<li>但在 service 和 dao 中并不需要成员变量，也就是可以通过改为单例来提高程序执行效率。</li>
<li>所以，第一次创建完对象以后，需要将对象存储起来。</li>
</ul>
</li>
<li>
<p>改进完以后的工厂</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-kd">public</span> <span class="highlight-kd">class</span> <span class="highlight-nc">BeanFactory</span> <span class="highlight-o">{</span>
    <span class="highlight-kd">private</span> <span class="highlight-kd">static</span> <span class="highlight-n">Properties</span> <span class="highlight-n">props</span><span class="highlight-o">;</span>
    <span class="highlight-kd">private</span> <span class="highlight-kd">static</span> <span class="highlight-n">Map</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">,</span> <span class="highlight-n">Object</span><span class="highlight-o">&gt;</span> <span class="highlight-n">beans</span><span class="highlight-o">;</span>

    <span class="highlight-kd">static</span> <span class="highlight-o">{</span>
        <span class="highlight-k">try</span> <span class="highlight-o">{</span>
            <span class="highlight-n">props</span> <span class="highlight-o">=</span> <span class="highlight-k">new</span> <span class="highlight-n">Properties</span><span class="highlight-o">();</span>
            <span class="highlight-n">InputStream</span> <span class="highlight-n">is</span> <span class="highlight-o">=</span> <span class="highlight-n">BeanFactory</span><span class="highlight-o">.</span><span class="highlight-na">class</span><span class="highlight-o">.</span><span class="highlight-na">getClassLoader</span><span class="highlight-o">().</span><span class="highlight-na">getResourceAsStream</span><span class="highlight-o">(</span><span class="highlight-s">"bean.properties"</span><span class="highlight-o">);</span>
            <span class="highlight-n">props</span><span class="highlight-o">.</span><span class="highlight-na">load</span><span class="highlight-o">(</span><span class="highlight-n">is</span><span class="highlight-o">);</span>
            <span class="highlight-n">beans</span> <span class="highlight-o">=</span> <span class="highlight-k">new</span> <span class="highlight-n">HashMap</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">,</span> <span class="highlight-n">Object</span><span class="highlight-o">&gt;();</span>
            <span class="highlight-c1">//取出配置文件中的数据存入容器
</span><span class="highlight-c1"></span>            <span class="highlight-n">Enumeration</span><span class="highlight-o">&lt;</span><span class="highlight-n">Object</span><span class="highlight-o">&gt;</span> <span class="highlight-n">keys</span> <span class="highlight-o">=</span> <span class="highlight-n">props</span><span class="highlight-o">.</span><span class="highlight-na">keys</span><span class="highlight-o">();</span>
            <span class="highlight-k">while</span> <span class="highlight-o">(</span><span class="highlight-n">keys</span><span class="highlight-o">.</span><span class="highlight-na">hasMoreElements</span><span class="highlight-o">())</span> <span class="highlight-o">{</span>
                <span class="highlight-n">String</span> <span class="highlight-n">key</span> <span class="highlight-o">=</span> <span class="highlight-n">keys</span><span class="highlight-o">.</span><span class="highlight-na">nextElement</span><span class="highlight-o">().</span><span class="highlight-na">toString</span><span class="highlight-o">();</span>
                <span class="highlight-n">String</span> <span class="highlight-n">beanPath</span> <span class="highlight-o">=</span> <span class="highlight-n">props</span><span class="highlight-o">.</span><span class="highlight-na">getProperty</span><span class="highlight-o">(</span><span class="highlight-n">key</span><span class="highlight-o">);</span>
                <span class="highlight-n">Object</span> <span class="highlight-n">value</span> <span class="highlight-o">=</span> <span class="highlight-n">Class</span><span class="highlight-o">.</span><span class="highlight-na">forName</span><span class="highlight-o">(</span><span class="highlight-n">beanPath</span><span class="highlight-o">).</span><span class="highlight-na">newInstance</span><span class="highlight-o">();</span>
                <span class="highlight-n">beans</span><span class="highlight-o">.</span><span class="highlight-na">put</span><span class="highlight-o">(</span><span class="highlight-n">key</span><span class="highlight-o">,</span> <span class="highlight-n">value</span><span class="highlight-o">);</span>
            <span class="highlight-o">}</span>

        <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Exception</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
            <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">ExceptionInInitializerError</span><span class="highlight-o">(</span><span class="highlight-s">"初始化properties失败！"</span><span class="highlight-o">);</span>
        <span class="highlight-o">}</span>
    <span class="highlight-o">}</span>

    <span class="highlight-kd">public</span> <span class="highlight-kd">static</span> <span class="highlight-n">Object</span> <span class="highlight-nf">getBean</span><span class="highlight-o">(</span><span class="highlight-n">String</span> <span class="highlight-n">beanName</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
        <span class="highlight-k">return</span> <span class="highlight-n">beans</span><span class="highlight-o">.</span><span class="highlight-na">get</span><span class="highlight-o">(</span><span class="highlight-n">beanName</span><span class="highlight-o">);</span>
    <span class="highlight-o">}</span>
<span class="highlight-o">}</span>
</code></pre>
<p>这样，每次从工厂获取的对象都是同一个，单例模式，提高了效率，但要注意不要使用成员变量，以免出现线程安全问题。</p>
</li>
</ul>
<h3 id="3--IoC-反转控制">3. IoC 反转控制</h3>
<ul>
<li>
<p>IoC 反转控制：把创建对象的权利交给框架，是框架的重要特征，削减计算机程序的耦合。</p>
</li>
<li>
<p>pom.xml 配置：</p>
<pre><code class="language-xml highlight-chroma"><span class="highlight-nt">&lt;dependency&gt;</span>
    <span class="highlight-nt">&lt;groupId&gt;</span>org.springframework<span class="highlight-nt">&lt;/groupId&gt;</span>
    <span class="highlight-nt">&lt;artifactId&gt;</span>spring-context<span class="highlight-nt">&lt;/artifactId&gt;</span>
    <span class="highlight-nt">&lt;version&gt;</span>5.0.2.RELEASE<span class="highlight-nt">&lt;/version&gt;</span>
<span class="highlight-nt">&lt;/dependency&gt;</span>
</code></pre>
</li>
<li>
<p>入门案例：</p>
<p>配置 XML 文件</p>
<pre><code class="language-xml highlight-chroma"><span class="highlight-cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="highlight-nt">&lt;beans</span> <span class="highlight-na">xmlns=</span><span class="highlight-s">"http://www.springframework.org/schema/beans"</span>
       <span class="highlight-na">xmlns:xsi=</span><span class="highlight-s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="highlight-na">xsi:schemaLocation=</span><span class="highlight-s">"http://www.springframework.org/schema/beans
</span><span class="highlight-s">        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="highlight-nt">&gt;</span>

    <span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"accountService"</span> <span class="highlight-na">class=</span><span class="highlight-s">"pers.ylq.service.impl.AccountServiceImpl"</span><span class="highlight-nt">/&gt;</span>
    <span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"accountDao"</span> <span class="highlight-na">class=</span><span class="highlight-s">"pers.ylq.dao.impl.AccountDaoImpl"</span><span class="highlight-nt">/&gt;</span>
<span class="highlight-nt">&lt;/beans&gt;</span>
</code></pre>
<ul>
<li>id 为唯一标识，用来获取</li>
<li>class 为所对应的类的全类名</li>
</ul>
<p>使用案例</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-kd">public</span> <span class="highlight-kd">static</span> <span class="highlight-kt">void</span> <span class="highlight-nf">main</span><span class="highlight-o">(</span><span class="highlight-n">String</span><span class="highlight-o">[]</span> <span class="highlight-n">args</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
    <span class="highlight-c1">//1.获取核心容器对象
</span><span class="highlight-c1"></span>    <span class="highlight-n">ApplicationContext</span> <span class="highlight-n">ac</span> <span class="highlight-o">=</span> <span class="highlight-k">new</span> <span class="highlight-n">ClassPathXmlApplicationContext</span><span class="highlight-o">(</span><span class="highlight-s">"bean.xml"</span><span class="highlight-o">);</span>
    <span class="highlight-c1">//2.根据id获取bean对象
</span><span class="highlight-c1"></span>    <span class="highlight-n">IAccountService</span> <span class="highlight-n">as</span> <span class="highlight-o">=</span> <span class="highlight-o">(</span><span class="highlight-n">IAccountService</span><span class="highlight-o">)</span> <span class="highlight-n">ac</span><span class="highlight-o">.</span><span class="highlight-na">getBean</span><span class="highlight-o">(</span><span class="highlight-s">"accountService"</span><span class="highlight-o">);</span>
    <span class="highlight-c1">//也可通过重载不强制转换
</span><span class="highlight-c1"></span>    <span class="highlight-n">IAccountDao</span> <span class="highlight-n">adao</span> <span class="highlight-o">=</span> <span class="highlight-n">ac</span><span class="highlight-o">.</span><span class="highlight-na">getBean</span><span class="highlight-o">(</span><span class="highlight-s">"accountDao"</span><span class="highlight-o">,</span> <span class="highlight-n">IAccountDao</span><span class="highlight-o">.</span><span class="highlight-na">class</span><span class="highlight-o">);</span>
<span class="highlight-o">}</span>
</code></pre>
</li>
<li>
<p>ApplicationContext 的三个常用实现类：</p>
<ul>
<li>ClassPathXmlApplicationContext：它可以加载类路径下的配置文件，要求配置文件必须在类路径下。不在的话，加载不了。(更常用)</li>
<li>FileSystemXmlApplicationContext：它可以加载磁盘任意路径下的配置文件(必须有访问权限）</li>
<li>AnnotationConfigApplicationContext：它是用于读取注解创建容器的。</li>
</ul>
</li>
<li>
<p>核心容器的两个接口引发出的问题：</p>
<ul>
<li>ApplicationContext：单例对象适用，我们一般采用此接口
<ul>
<li>它在构建核心容器时，创建对象采取的策略是采用立即加载的方式。也就是说，只要一读取完配置文件马上就创建配置文件中配置的对象。</li>
</ul>
</li>
<li>BeanFactory：多例对象适用
<ul>
<li>它在构建核心容器时，创建对象采取的策略是采用延迟加载的方式。也就是说，什么时候根据 id 获取对象了，什么时候才真正的创建对象。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>创建 Bean 的三种方式</p>
<ol>
<li>
<p>使用默认构造函数创建</p>
<pre><code class="language-xml highlight-chroma"><span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"accountService"</span> <span class="highlight-na">class=</span><span class="highlight-s">"com.itheima.service.impl.AccountServiceImpl"</span><span class="highlight-nt">&gt;&lt;/bean&gt;</span>
</code></pre>
</li>
<li>
<p>使用普通工厂中的方法创建对象（使用某个类中的方法创建对象），并存入 Spring 容器</p>
<pre><code class="language-xml highlight-chroma"><span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"instanceFactory"</span> <span class="highlight-na">class=</span><span class="highlight-s">"com.itheima.factory.InstanceFactory"</span><span class="highlight-nt">&gt;&lt;/bean&gt;</span>
<span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"accountService"</span> <span class="highlight-na">factory-bean=</span><span class="highlight-s">"instanceFactory"</span> <span class="highlight-na">factory-method=</span><span class="highlight-s">"getAccountService"</span><span class="highlight-nt">&gt;&lt;/bean&gt;</span>
</code></pre>
<p>factory-bean：指定所用的工厂的 id<br>
factory-method：指定所用工厂获取对象的方法名</p>
</li>
<li>
<p>使用工厂中的静态方法创建对象（使用某个类中的静态方法创建对象)，并存入 Spring 容器</p>
<pre><code class="language-xml highlight-chroma"><span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"accountService"</span> <span class="highlight-na">class=</span><span class="highlight-s">"com.itheima.factory.StaticFactory"</span> <span class="highlight-na">factory-method=</span><span class="highlight-s">"getAccountService"</span><span class="highlight-nt">&gt;&lt;/bean&gt;</span>
</code></pre>
<p>class：工厂类的全类名<br>
factory-method：指定所用工厂获取对象的静态方法名</p>
</li>
</ol>
</li>
<li>
<p>bean 的作用范围：bean 标签的 scope 属性，单例和多例最常用</p>
<ul>
<li>singleton：单例的（默认值）</li>
<li>prototype：多例的</li>
<li>request：作用于 Web 应用的请求范围</li>
<li>session：作用于 Web 应用的会话范围</li>
<li>global-session：作用于集群环境的会话范围（全局会话范围），当不是集群环境时，它就是 session。</li>
</ul>
</li>
<li>
<p>bean 的生命周期</p>
<ul>
<li>单例对象
<ul>
<li>出生：当容器创建时对象出生</li>
<li>活着：只要容器还在，对象一直活着</li>
<li>死亡：容器销毁，对象消亡</li>
<li>总结：单例对象的生命周期和容器相同</li>
</ul>
</li>
<li>多例对象
<ul>
<li>出生：当我们使用对象时 Spring 框架为我们创建</li>
<li>活着：对象只要是在使用过程中就一直活着。</li>
<li>死亡：当对象长时间不用，且没有别的对象引用时，由 Java 的垃圾回收器回收。</li>
</ul>
</li>
<li>在 bean 标签中，有 init-method 和 destory-method 两个属性，指定对象建立和对象销毁时执行的方法。</li>
</ul>
</li>
</ul>
<h3 id="4--DI-依赖注入">4. DI 依赖注入</h3>
<ul>
<li>
<p>DI：依赖注入（Dependency Injection）</p>
</li>
<li>
<p>依赖关系的管理：在当前类需要用到其他类的对象，由 Spring 为我们提供，我们只需要在配置文件中说明。</p>
</li>
<li>
<p>能注入的数据类型</p>
<ul>
<li>基本类型和 String</li>
<li>其他 bean 类型（在配置文件中或者注解配置过的 bean）</li>
<li>复杂类型/集合类型</li>
</ul>
</li>
<li>
<p>注入的方式：</p>
<ul>
<li>使用构造函数提供</li>
<li>使用 set 方法提供</li>
<li>使用注解提供</li>
</ul>
</li>
<li>
<p>构造函数注入：在 bean 标签内部使用标签 constructor-arg 来提供构造方法的参数，前提是有对应的构造方法</p>
<pre><code class="language-xml highlight-chroma"><span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"accountService"</span> <span class="highlight-na">class=</span><span class="highlight-s">"pers.ylq.service.impl.AccountServiceImpl"</span><span class="highlight-nt">&gt;</span>
    <span class="highlight-nt">&lt;constructor-arg</span> <span class="highlight-na">name=</span><span class="highlight-s">"username"</span> <span class="highlight-na">value=</span><span class="highlight-s">"张三"</span><span class="highlight-nt">/&gt;</span>
    <span class="highlight-nt">&lt;constructor-arg</span> <span class="highlight-na">name=</span><span class="highlight-s">"age"</span> <span class="highlight-na">value=</span><span class="highlight-s">"18"</span><span class="highlight-nt">/&gt;</span>
    <span class="highlight-nt">&lt;constructor-arg</span> <span class="highlight-na">name=</span><span class="highlight-s">"date"</span> <span class="highlight-na">ref=</span><span class="highlight-s">"now"</span><span class="highlight-nt">/&gt;</span>
<span class="highlight-nt">&lt;/bean&gt;</span>
<span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"now"</span> <span class="highlight-na">class=</span><span class="highlight-s">"java.util.Date"</span><span class="highlight-nt">/&gt;</span>
</code></pre>
<p>constructor-arg 标签的属性</p>
<ul>
<li>type：给指定类型的参数赋值(参数有多个相同类型则无法使用)，了解</li>
<li>index：给指定索引的参数赋值。索引的位置是从 0 开始，了解</li>
<li>name：给构造方法中指定名称的参数赋值。常用</li>
<li>===== 以上三个用于指定给构造函数中哪个参数赋值 =====</li>
<li>value：用于提供基本类型和 String 类型的数据</li>
<li>ref：用于指定其他的 bean 类型数据。它指的就是在 Spring 的 IoC 核心容器中出现过的 bean 对象</li>
</ul>
</li>
<li>
<p>构造函数注入</p>
<ul>
<li>优势：在获取 bean 对象时，注入数据是必须的操作，否则对象无法创建成功。</li>
<li>改变了 bean 对象的实例化方式，使我们在创建对象时，如果用不到这些数据，也必须提供。</li>
</ul>
</li>
<li>
<p>set 方法注入（常用）：在 bean 标签内部使用 property 标签，来调用 set 方法注入值。</p>
<pre><code class="language-xml highlight-chroma"><span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"now"</span> <span class="highlight-na">class=</span><span class="highlight-s">"java.util.Date"</span><span class="highlight-nt">/&gt;</span>
<span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"accountService2"</span> <span class="highlight-na">class=</span><span class="highlight-s">"pers.ylq.service.impl.AccountServiceImpl2"</span><span class="highlight-nt">&gt;</span>
    <span class="highlight-nt">&lt;property</span> <span class="highlight-na">name=</span><span class="highlight-s">"username"</span> <span class="highlight-na">value=</span><span class="highlight-s">"张三"</span><span class="highlight-nt">/&gt;</span>
    <span class="highlight-nt">&lt;property</span> <span class="highlight-na">name=</span><span class="highlight-s">"age"</span> <span class="highlight-na">value=</span><span class="highlight-s">"18"</span><span class="highlight-nt">/&gt;</span>
    <span class="highlight-nt">&lt;property</span> <span class="highlight-na">name=</span><span class="highlight-s">"date"</span> <span class="highlight-na">ref=</span><span class="highlight-s">"now"</span><span class="highlight-nt">/&gt;</span>
<span class="highlight-nt">&lt;/bean&gt;</span>
</code></pre>
<ul>
<li>类中需要有对应的 set 方法。</li>
<li>name：用于属性指定注入时所调用的 set 方法</li>
<li>value：用于提供基本类型和 String 类型的数据</li>
<li>ref：用于指定其他的 bean 类型数据。它指的就是在 Spring 的 IoC 核心容器中出现过的 bean 对象。</li>
</ul>
</li>
<li>
<p>set 方法注入：</p>
<ul>
<li>优势：创建对象时没有明确的限制，可以直接使用默认构造函数</li>
<li>弊端：如果有某个成员必须有值，则获取对象是有可能 set 方法没有执行。</li>
</ul>
</li>
<li>
<p>复杂类型的注入/集合类型的注入</p>
<pre><code class="language-xml highlight-chroma"><span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"accountService3"</span> <span class="highlight-na">class=</span><span class="highlight-s">"pers.ylq.service.impl.AccountServiceImpl3"</span><span class="highlight-nt">&gt;</span>
    <span class="highlight-nt">&lt;property</span> <span class="highlight-na">name=</span><span class="highlight-s">"mySet"</span><span class="highlight-nt">&gt;</span>
        <span class="highlight-nt">&lt;set&gt;</span>
            <span class="highlight-nt">&lt;value&gt;</span>AAA<span class="highlight-nt">&lt;/value&gt;</span>
            <span class="highlight-nt">&lt;value&gt;</span>BBB<span class="highlight-nt">&lt;/value&gt;</span>
            <span class="highlight-nt">&lt;value&gt;</span>CCC<span class="highlight-nt">&lt;/value&gt;</span>
        <span class="highlight-nt">&lt;/set&gt;</span>
    <span class="highlight-nt">&lt;/property&gt;</span>
    <span class="highlight-nt">&lt;property</span> <span class="highlight-na">name=</span><span class="highlight-s">"myList"</span><span class="highlight-nt">&gt;</span>
        <span class="highlight-nt">&lt;list&gt;</span>
            <span class="highlight-nt">&lt;value&gt;</span>AAA<span class="highlight-nt">&lt;/value&gt;</span>
            <span class="highlight-nt">&lt;value&gt;</span>BBB<span class="highlight-nt">&lt;/value&gt;</span>
            <span class="highlight-nt">&lt;value&gt;</span>CCC<span class="highlight-nt">&lt;/value&gt;</span>
        <span class="highlight-nt">&lt;/list&gt;</span>
    <span class="highlight-nt">&lt;/property&gt;</span>
    <span class="highlight-nt">&lt;property</span> <span class="highlight-na">name=</span><span class="highlight-s">"myMap"</span><span class="highlight-nt">&gt;</span>
        <span class="highlight-nt">&lt;map&gt;</span>
            <span class="highlight-nt">&lt;entry</span> <span class="highlight-na">key=</span><span class="highlight-s">"testA"</span> <span class="highlight-na">value=</span><span class="highlight-s">"aaa"</span><span class="highlight-nt">&gt;&lt;/entry&gt;</span>
            <span class="highlight-nt">&lt;entry</span> <span class="highlight-na">key=</span><span class="highlight-s">"testB"</span><span class="highlight-nt">&gt;</span>
                <span class="highlight-nt">&lt;value&gt;</span>BBB<span class="highlight-nt">&lt;/value&gt;</span>
            <span class="highlight-nt">&lt;/entry&gt;</span>
        <span class="highlight-nt">&lt;/map&gt;</span>
    <span class="highlight-nt">&lt;/property&gt;</span>
    <span class="highlight-nt">&lt;property</span> <span class="highlight-na">name=</span><span class="highlight-s">"myProps"</span><span class="highlight-nt">&gt;</span>
        <span class="highlight-nt">&lt;props&gt;</span>
            <span class="highlight-nt">&lt;prop</span> <span class="highlight-na">key=</span><span class="highlight-s">"testC"</span><span class="highlight-nt">&gt;</span>ccc<span class="highlight-nt">&lt;/prop&gt;</span>
            <span class="highlight-nt">&lt;prop</span> <span class="highlight-na">key=</span><span class="highlight-s">"testD"</span><span class="highlight-nt">&gt;</span>ddd<span class="highlight-nt">&lt;/prop&gt;</span>
        <span class="highlight-nt">&lt;/props&gt;</span>
    <span class="highlight-nt">&lt;/property&gt;</span>
<span class="highlight-nt">&lt;/bean&gt;</span>
</code></pre>
<ul>
<li>用于给 List 结构集合注入的标签：list、array、set</li>
<li>用于个 Map 结构集合注入的标签： map、props</li>
<li>结构相同，标签可以互换</li>
</ul>
</li>
</ul>
<h3 id="5--Spring-的常用注解">5. Spring 的常用注解</h3>
<ul>
<li>
<p>使用注解的前提：</p>
<ul>
<li>需要使用 xmlns:context 命名空间</li>
<li>需要指定要扫描的包，扫描包及其子包的注解</li>
</ul>
<pre><code class="language-xml highlight-chroma"><span class="highlight-cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="highlight-nt">&lt;beans</span> <span class="highlight-na">xmlns=</span><span class="highlight-s">"http://www.springframework.org/schema/beans"</span>
       <span class="highlight-na">xmlns:xsi=</span><span class="highlight-s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="highlight-na">xmlns:context=</span><span class="highlight-s">"http://www.springframework.org/schema/context"</span>
       <span class="highlight-na">xsi:schemaLocation=</span><span class="highlight-s">"http://www.springframework.org/schema/beans
</span><span class="highlight-s">        http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="highlight-s">        http://www.springframework.org/schema/context
</span><span class="highlight-s">        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="highlight-nt">&gt;</span>

    <span class="highlight-nt">&lt;context:component-scan</span> <span class="highlight-na">base-package=</span><span class="highlight-s">"pers.ylq"</span><span class="highlight-nt">/&gt;</span>
<span class="highlight-nt">&lt;/beans&gt;</span>
</code></pre>
</li>
<li>
<p>用于创建对象的注解</p>
<ul>
<li>Component：用于把当前类对象存入 Spring 容器中
<ul>
<li>属性 value：用于指定 bean 的 id。当我们不写时，它的默认值是当前类名，且首字母改小写。</li>
</ul>
</li>
<li>Controller：一般用在表现层</li>
<li>Service：一般用在业务层</li>
<li>Repository：一般用在持久层</li>
<li>后三个是 Spring 框架提供明确的三层使用的注解，使我们的三层对象更加清晰，作用和属性与 Component 一致。</li>
</ul>
</li>
<li>
<p>用于注入数据的注解</p>
<ul>
<li>
<p>Autowired：自动按照类型注入。</p>
<ul>
<li>位置：可以是变量上，也可以是方法上。</li>
<li>细节：可以不添加 set 方法就能注入。</li>
<li>只要容器中有唯一的一个 bean 对象类型和要注入的变量类型匹配，就可以注入成功</li>
<li>如果类型匹配的有多个，则会用变量名和 bean 对象类型的 id 去进行匹配，若一致，也会注入成功。</li>
<li><img src="https://raw.githubusercontent.com/Rainsheep/pic-bed/master/img/2020-03-07+00:58:01+%E8%87%AA%E5%8A%A8%E6%8C%89%E7%85%A7%E7%B1%BB%E5%9E%8B%E6%B3%A8%E5%85%A5.png" alt=""></li>
</ul>
</li>
<li>
<p>Qualifier：在按照类中注入的基础之上(@Autowired)再按照名称注入。它在给类成员注入时不能单独使用。但是在给方法参数注入时可以单独使用。</p>
<pre><code class="highlight-chroma">@Autowried
@Qualifier("id")
</code></pre>
<p>属性 value：用于指定注入 bean 的 id。</p>
</li>
<li>
<p>Resource：直接按照 bean 的 id 注入。它可以独立使用，此注解由 J2EE 提供，不能作用方法与参数。</p>
<ul>
<li>属性 name：用于指定 bean 的 id。</li>
</ul>
</li>
<li>
<p>Value：用于注入基本类型和 String 类型的数据</p>
<ul>
<li>属性 value：用于指定数据的值。它可以使用 Spring 的 EL 表达式，<code>${表达式}</code></li>
</ul>
</li>
<li>
<p>集合类型的注入只能通过 XML 来实现。</p>
</li>
</ul>
</li>
<li>
<p>用于改变作用范围的注解</p>
<ul>
<li>Scope：用于指定 bean 的作用范围
<ul>
<li>属性 value：指定范围的取值。常用取值：singleton(单例)、prototype(多例)</li>
</ul>
</li>
</ul>
</li>
<li>
<p>和生命周期相关注解（了解）</p>
<ul>
<li>作用就和在 bean 标签中使用 init-method 和 destroy-methode 的作用是一样的</li>
<li>PostConstruct：用于指定初始化方法</li>
<li>PreDestroy：用于指定销毁方法</li>
</ul>
</li>
</ul>
<h3 id="6--Spring-新注解">6. Spring 新注解</h3>
<ul>
<li>Configuration：指定当前类是一个 Spring 配置类
<ul>
<li>当使用注解配置  Spring 的时候，通过 <code>ApplicationContext ac = new AnnotationConfigApplicationContext(SpringConfiguration.class);</code> 来获取容器。</li>
<li>当配置类作为 AnnotationConfigApplicationContext 对象创建的参数时，该注解可以不写，否则需要扫描该类所在的包并用此注解声明此类是一个配置类或者使用 Impor 注解导入到主配置文件。</li>
</ul>
</li>
<li>ComponentScan：用于通过注解指定 Spring 在创建容器时要扫描的包
<ul>
<li>属性 value：用于指定创建容器时要扫描的包。使用该注解就不需要在 XML 中使用 context:component-scan 标签。</li>
<li>属性 basePackages：和 value 一样。</li>
</ul>
</li>
<li>Bean：用于把当前方法的返回值作为 bean 对象存入 Spring 的 IoC 容器中
<ul>
<li>属性 name：用于指定 bean 的 id。默认值是当前方法的名称</li>
<li>当我们使用注解配置方法时，如果方法有参数，Spring 框架会去容器中查找有没有可用的 bean 对象，查找的方式和 Autowired 注解的作用是一样的，可以使用 Qualifier 去指定使用的 bean 对象。</li>
<li>
<pre><code class="language-java highlight-chroma"><span class="highlight-nd">@Bean</span><span class="highlight-o">(</span><span class="highlight-n">name</span> <span class="highlight-o">=</span> <span class="highlight-s">"queryRunner"</span><span class="highlight-o">)</span>
<span class="highlight-nd">@Scope</span><span class="highlight-o">(</span><span class="highlight-s">"prototype"</span><span class="highlight-o">)</span>
<span class="highlight-kd">public</span> <span class="highlight-n">QueryRunner</span> <span class="highlight-nf">createQueryRunner</span><span class="highlight-o">(</span><span class="highlight-nd">@Qualifier</span><span class="highlight-o">(</span><span class="highlight-s">"ds1"</span><span class="highlight-o">)</span> <span class="highlight-n">DataSource</span> <span class="highlight-n">dataSource</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
    <span class="highlight-k">return</span> <span class="highlight-k">new</span> <span class="highlight-n">QueryRunner</span><span class="highlight-o">(</span><span class="highlight-n">dataSource</span><span class="highlight-o">);</span>
<span class="highlight-o">}</span>
</code></pre>
</li>
</ul>
</li>
<li>Import：用于导入其他的配置类
<ul>
<li>属性 value：用于指定其他配置类的字节码，当我们使用 Import 的注解之后，此类就父配置类，而导入的都是子配置类。</li>
</ul>
</li>
<li>PropertySource：用于指定 properties 文件的位置
<ul>
<li>
<p>属性 value：指定文件的名称和路径。</p>
<ul>
<li>关键字：classpath，表示类路径下</li>
</ul>
</li>
<li>
<pre><code class="language-java highlight-chroma"><span class="highlight-nd">@PropertySource</span><span class="highlight-o">(</span><span class="highlight-s">"classpath:jdbcConfig.properties"</span><span class="highlight-o">)</span>
<span class="highlight-kd">public</span> <span class="highlight-kd">class</span> <span class="highlight-nc">JdbcConfiguration</span> <span class="highlight-o">{</span>
    <span class="highlight-nd">@Value</span><span class="highlight-o">(</span><span class="highlight-s">"${driver}"</span><span class="highlight-o">)</span>
    <span class="highlight-kd">private</span> <span class="highlight-n">String</span> <span class="highlight-n">driver</span><span class="highlight-o">;</span>
    <span class="highlight-nd">@Value</span><span class="highlight-o">(</span><span class="highlight-s">"${url}"</span><span class="highlight-o">)</span>
    <span class="highlight-kd">private</span> <span class="highlight-n">String</span> <span class="highlight-n">url</span><span class="highlight-o">;</span>
    <span class="highlight-nd">@Value</span><span class="highlight-o">(</span><span class="highlight-s">"${jdbc.username}"</span><span class="highlight-o">)</span>
    <span class="highlight-kd">private</span> <span class="highlight-n">String</span> <span class="highlight-n">username</span><span class="highlight-o">;</span>
    <span class="highlight-nd">@Value</span><span class="highlight-o">(</span><span class="highlight-s">"${password}"</span><span class="highlight-o">)</span>
    <span class="highlight-kd">private</span> <span class="highlight-n">String</span> <span class="highlight-n">password</span><span class="highlight-o">;</span>
    <span class="highlight-nd">@Bean</span><span class="highlight-o">(</span><span class="highlight-n">name</span> <span class="highlight-o">=</span> <span class="highlight-s">"dataSource"</span><span class="highlight-o">)</span>
    <span class="highlight-kd">public</span> <span class="highlight-n">DataSource</span> <span class="highlight-nf">createDataSource</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
        <span class="highlight-n">ComboPooledDataSource</span> <span class="highlight-n">ds</span> <span class="highlight-o">=</span> <span class="highlight-k">new</span> <span class="highlight-n">ComboPooledDataSource</span><span class="highlight-o">();</span>
        <span class="highlight-k">try</span> <span class="highlight-o">{</span>
            <span class="highlight-n">ds</span><span class="highlight-o">.</span><span class="highlight-na">setDriverClass</span><span class="highlight-o">(</span><span class="highlight-n">driver</span><span class="highlight-o">);</span>
        <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">PropertyVetoException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
            <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">printStackTrace</span><span class="highlight-o">();</span>
        <span class="highlight-o">}</span>
        <span class="highlight-n">ds</span><span class="highlight-o">.</span><span class="highlight-na">setJdbcUrl</span><span class="highlight-o">(</span><span class="highlight-n">url</span><span class="highlight-o">);</span>
        <span class="highlight-n">ds</span><span class="highlight-o">.</span><span class="highlight-na">setUser</span><span class="highlight-o">(</span><span class="highlight-n">username</span><span class="highlight-o">);</span>
        <span class="highlight-n">ds</span><span class="highlight-o">.</span><span class="highlight-na">setPassword</span><span class="highlight-o">(</span><span class="highlight-n">password</span><span class="highlight-o">);</span>
        <span class="highlight-k">return</span> <span class="highlight-n">ds</span><span class="highlight-o">;</span>
    <span class="highlight-o">}</span>
<span class="highlight-o">}</span>
</code></pre>
<ul>
<li><code>${username}</code> 取出的是主机名，不是数据库用户名</li>
</ul>
</li>
</ul>
</li>
<li>注解用于自己定义的类时方便，XML 在引入第三方类时方便。<img src="https://raw.githubusercontent.com/Rainsheep/pic-bed/master/img/2020-03-07+04:23:41+p_2020030704362336SS.png" alt=""></li>
</ul>
<h3 id="7--Spring-整合-Junit">7. Spring 整合 Junit</h3>
<ul>
<li>我们需要程序能自动帮我们创建容器，能够在测试类中进行依赖注入。</li>
</ul>
<ol>
<li>
<p>导入 Spring 整合 junit 的 jar(坐标)</p>
<pre><code class="language-xml highlight-chroma"><span class="highlight-nt">&lt;dependency&gt;</span>
    <span class="highlight-nt">&lt;groupId&gt;</span>org.springframework<span class="highlight-nt">&lt;/groupId&gt;</span>
    <span class="highlight-nt">&lt;artifactId&gt;</span>spring-test<span class="highlight-nt">&lt;/artifactId&gt;</span>
    <span class="highlight-nt">&lt;version&gt;</span>5.0.2.RELEASE<span class="highlight-nt">&lt;/version&gt;</span>
<span class="highlight-nt">&lt;/dependency&gt;</span>
</code></pre>
</li>
<li>
<p>使用 Junit 提供的注解 @Runwith 把原有的 main 方法替换了，替换成 Spring 提供的</p>
</li>
<li>
<p>告知 Spring 的运行器，Spring 和 IoC 创建是基于 XML 还是注解的，并且说明位置</p>
<ul>
<li>@ContextConfiguration
<ul>
<li>locations：指定 xml 文件的位置，加上 classpath 关键字，表示在类路径下</li>
<li>classes：指定注解类所在地位置</li>
</ul>
</li>
</ul>
<pre><code class="language-java highlight-chroma"><span class="highlight-nd">@RunWith</span><span class="highlight-o">(</span><span class="highlight-n">SpringJUnit4ClassRunner</span><span class="highlight-o">.</span><span class="highlight-na">class</span><span class="highlight-o">)</span>
<span class="highlight-nd">@ContextConfiguration</span><span class="highlight-o">(</span><span class="highlight-n">classes</span> <span class="highlight-o">=</span> <span class="highlight-n">SpringConfiguration</span><span class="highlight-o">.</span><span class="highlight-na">class</span><span class="highlight-o">)</span>
<span class="highlight-c1">//@ContextConfiguration(locatios = "classpath:bean.xml")
</span><span class="highlight-c1"></span><span class="highlight-kd">public</span> <span class="highlight-kd">class</span> <span class="highlight-nc">AccountServiceTest</span> <span class="highlight-o">{</span>
    <span class="highlight-nd">@Autowired</span>
    <span class="highlight-kd">private</span> <span class="highlight-n">IAccountService</span> <span class="highlight-n">as</span> <span class="highlight-o">=</span> <span class="highlight-kc">null</span><span class="highlight-o">;</span>
    <span class="highlight-nd">@Test</span>
    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">testFindAll</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
        <span class="highlight-n">List</span><span class="highlight-o">&lt;</span><span class="highlight-n">Account</span><span class="highlight-o">&gt;</span> <span class="highlight-n">accounts</span> <span class="highlight-o">=</span> <span class="highlight-n">as</span><span class="highlight-o">.</span><span class="highlight-na">findAllAccount</span><span class="highlight-o">();</span>
    <span class="highlight-o">}</span>
<span class="highlight-o">}</span>
</code></pre>
</li>
</ol>
<h3 id="8--银行转账案例">8. 银行转账案例</h3>
<ul>
<li>转账过程中的事务问题<img src="https://raw.githubusercontent.com/Rainsheep/pic-bed/master/img/2020-03-07+16:30:33+%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6.png" alt=""></li>
<li>可见，每次操作数据库都是一个单独的事务，事务管理发生在持久层，我们需要让事务管理由业务层管理。</li>
<li>ThreadLocal 是线程的局部变量存储容器，可以在线程中通过 <code>set()</code> 和 <code>get()</code> 存取变量。</li>
<li>解决转账事务问题：
<ul>
<li>编写连接工具类，将线程和连接进行绑定
<pre><code class="language-java highlight-chroma"><span class="highlight-kn">package</span> <span class="highlight-nn">com.itheima.utils</span><span class="highlight-o">;</span>

<span class="highlight-kn">import</span> <span class="highlight-nn">javax.sql.DataSource</span><span class="highlight-o">;</span>
<span class="highlight-kn">import</span> <span class="highlight-nn">java.sql.Connection</span><span class="highlight-o">;</span>

<span class="highlight-cm">/**
</span><span class="highlight-cm"> * 连接的工具类，它用于从数据源中获取一个连接，并且实现和线程的绑定
</span><span class="highlight-cm"> */</span>
<span class="highlight-kd">public</span> <span class="highlight-kd">class</span> <span class="highlight-nc">ConnectionUtils</span> <span class="highlight-o">{</span>

    <span class="highlight-kd">private</span> <span class="highlight-n">ThreadLocal</span><span class="highlight-o">&lt;</span><span class="highlight-n">Connection</span><span class="highlight-o">&gt;</span> <span class="highlight-n">tl</span> <span class="highlight-o">=</span> <span class="highlight-k">new</span> <span class="highlight-n">ThreadLocal</span><span class="highlight-o">&lt;</span><span class="highlight-n">Connection</span><span class="highlight-o">&gt;();</span>

    <span class="highlight-kd">private</span> <span class="highlight-n">DataSource</span> <span class="highlight-n">dataSource</span><span class="highlight-o">;</span>

    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">setDataSource</span><span class="highlight-o">(</span><span class="highlight-n">DataSource</span> <span class="highlight-n">dataSource</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
        <span class="highlight-k">this</span><span class="highlight-o">.</span><span class="highlight-na">dataSource</span> <span class="highlight-o">=</span> <span class="highlight-n">dataSource</span><span class="highlight-o">;</span>
    <span class="highlight-o">}</span>

    <span class="highlight-cm">/**
</span><span class="highlight-cm">     * 获取当前线程上的连接
</span><span class="highlight-cm">     * @return
</span><span class="highlight-cm">     */</span>
    <span class="highlight-kd">public</span> <span class="highlight-n">Connection</span> <span class="highlight-nf">getThreadConnection</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
        <span class="highlight-k">try</span><span class="highlight-o">{</span>
            <span class="highlight-c1">//1.先从ThreadLocal上获取
</span><span class="highlight-c1"></span>            <span class="highlight-n">Connection</span> <span class="highlight-n">conn</span> <span class="highlight-o">=</span> <span class="highlight-n">tl</span><span class="highlight-o">.</span><span class="highlight-na">get</span><span class="highlight-o">();</span>
            <span class="highlight-c1">//2.判断当前线程上是否有连接
</span><span class="highlight-c1"></span>            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-n">conn</span> <span class="highlight-o">==</span> <span class="highlight-kc">null</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
                <span class="highlight-c1">//3.从数据源中获取一个连接，并且存入ThreadLocal中
</span><span class="highlight-c1"></span>                <span class="highlight-n">conn</span> <span class="highlight-o">=</span> <span class="highlight-n">dataSource</span><span class="highlight-o">.</span><span class="highlight-na">getConnection</span><span class="highlight-o">();</span>
                <span class="highlight-n">tl</span><span class="highlight-o">.</span><span class="highlight-na">set</span><span class="highlight-o">(</span><span class="highlight-n">conn</span><span class="highlight-o">);</span>
            <span class="highlight-o">}</span>
            <span class="highlight-c1">//4.返回当前线程上的连接
</span><span class="highlight-c1"></span>            <span class="highlight-k">return</span> <span class="highlight-n">conn</span><span class="highlight-o">;</span>
        <span class="highlight-o">}</span><span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Exception</span> <span class="highlight-n">e</span><span class="highlight-o">){</span>
            <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
        <span class="highlight-o">}</span>
    <span class="highlight-o">}</span>

    <span class="highlight-cm">/**
</span><span class="highlight-cm">     * 把连接和线程解绑
</span><span class="highlight-cm">     */</span>
    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">removeConnection</span><span class="highlight-o">(){</span>
        <span class="highlight-n">tl</span><span class="highlight-o">.</span><span class="highlight-na">remove</span><span class="highlight-o">();</span>
    <span class="highlight-o">}</span>
<span class="highlight-o">}</span>
</code></pre>
</li>
<li>编写事务管理类
<pre><code class="language-java highlight-chroma"><span class="highlight-kn">package</span> <span class="highlight-nn">com.itheima.utils</span><span class="highlight-o">;</span>

<span class="highlight-cm">/**
</span><span class="highlight-cm"> * 和事务管理相关的工具类，它包含了，开启事务，提交事务，回滚事务和释放连接
</span><span class="highlight-cm"> */</span>
<span class="highlight-kd">public</span> <span class="highlight-kd">class</span> <span class="highlight-nc">TransactionManager</span> <span class="highlight-o">{</span>

    <span class="highlight-kd">private</span> <span class="highlight-n">ConnectionUtils</span> <span class="highlight-n">connectionUtils</span><span class="highlight-o">;</span>

    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">setConnectionUtils</span><span class="highlight-o">(</span><span class="highlight-n">ConnectionUtils</span> <span class="highlight-n">connectionUtils</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
        <span class="highlight-k">this</span><span class="highlight-o">.</span><span class="highlight-na">connectionUtils</span> <span class="highlight-o">=</span> <span class="highlight-n">connectionUtils</span><span class="highlight-o">;</span>
    <span class="highlight-o">}</span>

    <span class="highlight-cm">/**
</span><span class="highlight-cm">     * 开启事务
</span><span class="highlight-cm">     */</span>
    <span class="highlight-kd">public</span>  <span class="highlight-kt">void</span> <span class="highlight-nf">beginTransaction</span><span class="highlight-o">(){</span>
        <span class="highlight-k">try</span> <span class="highlight-o">{</span>
            <span class="highlight-n">connectionUtils</span><span class="highlight-o">.</span><span class="highlight-na">getThreadConnection</span><span class="highlight-o">().</span><span class="highlight-na">setAutoCommit</span><span class="highlight-o">(</span><span class="highlight-kc">false</span><span class="highlight-o">);</span>
        <span class="highlight-o">}</span><span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Exception</span> <span class="highlight-n">e</span><span class="highlight-o">){</span>
            <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">printStackTrace</span><span class="highlight-o">();</span>
        <span class="highlight-o">}</span>
    <span class="highlight-o">}</span>

    <span class="highlight-cm">/**
</span><span class="highlight-cm">     * 提交事务
</span><span class="highlight-cm">     */</span>
    <span class="highlight-kd">public</span>  <span class="highlight-kt">void</span> <span class="highlight-nf">commit</span><span class="highlight-o">(){</span>
        <span class="highlight-k">try</span> <span class="highlight-o">{</span>
            <span class="highlight-n">connectionUtils</span><span class="highlight-o">.</span><span class="highlight-na">getThreadConnection</span><span class="highlight-o">().</span><span class="highlight-na">commit</span><span class="highlight-o">();</span>
        <span class="highlight-o">}</span><span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Exception</span> <span class="highlight-n">e</span><span class="highlight-o">){</span>
            <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">printStackTrace</span><span class="highlight-o">();</span>
        <span class="highlight-o">}</span>
    <span class="highlight-o">}</span>

    <span class="highlight-cm">/**
</span><span class="highlight-cm">     * 回滚事务
</span><span class="highlight-cm">     */</span>
    <span class="highlight-kd">public</span>  <span class="highlight-kt">void</span> <span class="highlight-nf">rollback</span><span class="highlight-o">(){</span>
        <span class="highlight-k">try</span> <span class="highlight-o">{</span>
            <span class="highlight-n">connectionUtils</span><span class="highlight-o">.</span><span class="highlight-na">getThreadConnection</span><span class="highlight-o">().</span><span class="highlight-na">rollback</span><span class="highlight-o">();</span>
        <span class="highlight-o">}</span><span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Exception</span> <span class="highlight-n">e</span><span class="highlight-o">){</span>
            <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">printStackTrace</span><span class="highlight-o">();</span>
        <span class="highlight-o">}</span>
    <span class="highlight-o">}</span>


    <span class="highlight-cm">/**
</span><span class="highlight-cm">     * 释放连接
</span><span class="highlight-cm">     */</span>
    <span class="highlight-kd">public</span>  <span class="highlight-kt">void</span> <span class="highlight-nf">release</span><span class="highlight-o">(){</span>
        <span class="highlight-k">try</span> <span class="highlight-o">{</span>
            <span class="highlight-n">connectionUtils</span><span class="highlight-o">.</span><span class="highlight-na">getThreadConnection</span><span class="highlight-o">().</span><span class="highlight-na">close</span><span class="highlight-o">();</span><span class="highlight-c1">//还回连接池中
</span><span class="highlight-c1"></span>            <span class="highlight-n">connectionUtils</span><span class="highlight-o">.</span><span class="highlight-na">removeConnection</span><span class="highlight-o">();</span>
        <span class="highlight-o">}</span><span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Exception</span> <span class="highlight-n">e</span><span class="highlight-o">){</span>
            <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">printStackTrace</span><span class="highlight-o">();</span>
        <span class="highlight-o">}</span>
    <span class="highlight-o">}</span>
<span class="highlight-o">}</span>
</code></pre>
</li>
<li>在 dao 层使用 connectionUtils 获取连接
<pre><code class="language-java highlight-chroma"><span class="highlight-kd">public</span> <span class="highlight-kd">class</span> <span class="highlight-nc">AccountDaoImpl</span> <span class="highlight-kd">implements</span> <span class="highlight-n">IAccountDao</span> <span class="highlight-o">{</span>

    <span class="highlight-kd">private</span> <span class="highlight-n">QueryRunner</span> <span class="highlight-n">runner</span><span class="highlight-o">;</span>
    <span class="highlight-kd">private</span> <span class="highlight-n">ConnectionUtils</span> <span class="highlight-n">connectionUtils</span><span class="highlight-o">;</span>

    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">setRunner</span><span class="highlight-o">(</span><span class="highlight-n">QueryRunner</span> <span class="highlight-n">runner</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
        <span class="highlight-k">this</span><span class="highlight-o">.</span><span class="highlight-na">runner</span> <span class="highlight-o">=</span> <span class="highlight-n">runner</span><span class="highlight-o">;</span>
    <span class="highlight-o">}</span>

    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">setConnectionUtils</span><span class="highlight-o">(</span><span class="highlight-n">ConnectionUtils</span> <span class="highlight-n">connectionUtils</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
        <span class="highlight-k">this</span><span class="highlight-o">.</span><span class="highlight-na">connectionUtils</span> <span class="highlight-o">=</span> <span class="highlight-n">connectionUtils</span><span class="highlight-o">;</span>
    <span class="highlight-o">}</span>

    <span class="highlight-nd">@Override</span>
    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">updateAccount</span><span class="highlight-o">(</span><span class="highlight-n">Account</span> <span class="highlight-n">account</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
        <span class="highlight-k">try</span> <span class="highlight-o">{</span>
            <span class="highlight-n">runner</span><span class="highlight-o">.</span><span class="highlight-na">update</span><span class="highlight-o">(</span><span class="highlight-n">connectionUtils</span><span class="highlight-o">.</span><span class="highlight-na">getThreadConnection</span><span class="highlight-o">(),</span><span class="highlight-s">"update account set name=?,money=? where id=?"</span><span class="highlight-o">,</span> <span class="highlight-n">account</span><span class="highlight-o">.</span><span class="highlight-na">getName</span><span class="highlight-o">(),</span> <span class="highlight-n">account</span><span class="highlight-o">.</span><span class="highlight-na">getMoney</span><span class="highlight-o">(),</span> <span class="highlight-n">account</span><span class="highlight-o">.</span><span class="highlight-na">getId</span><span class="highlight-o">());</span>
        <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Exception</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
            <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
        <span class="highlight-o">}</span>
    <span class="highlight-o">}</span>
<span class="highlight-o">}</span>
</code></pre>
</li>
<li>在 service 层进行事务的管理
<pre><code class="language-java highlight-chroma"><span class="highlight-kd">public</span> <span class="highlight-kd">class</span> <span class="highlight-nc">AccountServiceImpl_OLD</span> <span class="highlight-kd">implements</span> <span class="highlight-n">IAccountService</span> <span class="highlight-o">{</span>

    <span class="highlight-kd">private</span> <span class="highlight-n">IAccountDao</span> <span class="highlight-n">accountDao</span><span class="highlight-o">;</span>
    <span class="highlight-kd">private</span> <span class="highlight-n">TransactionManager</span> <span class="highlight-n">txManager</span><span class="highlight-o">;</span>

    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">setTxManager</span><span class="highlight-o">(</span><span class="highlight-n">TransactionManager</span> <span class="highlight-n">txManager</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
        <span class="highlight-k">this</span><span class="highlight-o">.</span><span class="highlight-na">txManager</span> <span class="highlight-o">=</span> <span class="highlight-n">txManager</span><span class="highlight-o">;</span>
    <span class="highlight-o">}</span>

    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">setAccountDao</span><span class="highlight-o">(</span><span class="highlight-n">IAccountDao</span> <span class="highlight-n">accountDao</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
        <span class="highlight-k">this</span><span class="highlight-o">.</span><span class="highlight-na">accountDao</span> <span class="highlight-o">=</span> <span class="highlight-n">accountDao</span><span class="highlight-o">;</span>
    <span class="highlight-o">}</span>

    <span class="highlight-nd">@Override</span>
    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">transfer</span><span class="highlight-o">(</span><span class="highlight-n">String</span> <span class="highlight-n">sourceName</span><span class="highlight-o">,</span> <span class="highlight-n">String</span> <span class="highlight-n">targetName</span><span class="highlight-o">,</span> <span class="highlight-n">Float</span> <span class="highlight-n">money</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
        <span class="highlight-k">try</span> <span class="highlight-o">{</span>
            <span class="highlight-c1">//1.开启事务
</span><span class="highlight-c1"></span>            <span class="highlight-n">txManager</span><span class="highlight-o">.</span><span class="highlight-na">beginTransaction</span><span class="highlight-o">();</span>
            <span class="highlight-c1">//2.执行操作
</span><span class="highlight-c1"></span>            <span class="highlight-c1">//2.1根据名称查询转出账户
</span><span class="highlight-c1"></span>            <span class="highlight-n">Account</span> <span class="highlight-n">source</span> <span class="highlight-o">=</span> <span class="highlight-n">accountDao</span><span class="highlight-o">.</span><span class="highlight-na">findAccountByName</span><span class="highlight-o">(</span><span class="highlight-n">sourceName</span><span class="highlight-o">);</span>
            <span class="highlight-c1">//2.2根据名称查询转入账户
</span><span class="highlight-c1"></span>            <span class="highlight-n">Account</span> <span class="highlight-n">target</span> <span class="highlight-o">=</span> <span class="highlight-n">accountDao</span><span class="highlight-o">.</span><span class="highlight-na">findAccountByName</span><span class="highlight-o">(</span><span class="highlight-n">targetName</span><span class="highlight-o">);</span>
            <span class="highlight-c1">//2.3转出账户减钱
</span><span class="highlight-c1"></span>            <span class="highlight-n">source</span><span class="highlight-o">.</span><span class="highlight-na">setMoney</span><span class="highlight-o">(</span><span class="highlight-n">source</span><span class="highlight-o">.</span><span class="highlight-na">getMoney</span><span class="highlight-o">()-</span><span class="highlight-n">money</span><span class="highlight-o">);</span>
            <span class="highlight-c1">//2.4转入账户加钱
</span><span class="highlight-c1"></span>            <span class="highlight-n">target</span><span class="highlight-o">.</span><span class="highlight-na">setMoney</span><span class="highlight-o">(</span><span class="highlight-n">target</span><span class="highlight-o">.</span><span class="highlight-na">getMoney</span><span class="highlight-o">()+</span><span class="highlight-n">money</span><span class="highlight-o">);</span>
            <span class="highlight-c1">//2.5更新转出账户
</span><span class="highlight-c1"></span>            <span class="highlight-n">accountDao</span><span class="highlight-o">.</span><span class="highlight-na">updateAccount</span><span class="highlight-o">(</span><span class="highlight-n">source</span><span class="highlight-o">);</span>
            <span class="highlight-c1">//int i=1/0;
</span><span class="highlight-c1"></span>            <span class="highlight-c1">//2.6更新转入账户
</span><span class="highlight-c1"></span>            <span class="highlight-n">accountDao</span><span class="highlight-o">.</span><span class="highlight-na">updateAccount</span><span class="highlight-o">(</span><span class="highlight-n">target</span><span class="highlight-o">);</span>
            <span class="highlight-c1">//3.提交事务
</span><span class="highlight-c1"></span>            <span class="highlight-n">txManager</span><span class="highlight-o">.</span><span class="highlight-na">commit</span><span class="highlight-o">();</span>
        <span class="highlight-o">}</span><span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Exception</span> <span class="highlight-n">e</span><span class="highlight-o">){</span>
            <span class="highlight-c1">//4.回滚操作
</span><span class="highlight-c1"></span>            <span class="highlight-n">txManager</span><span class="highlight-o">.</span><span class="highlight-na">rollback</span><span class="highlight-o">();</span>
            <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">printStackTrace</span><span class="highlight-o">();</span>
        <span class="highlight-o">}</span><span class="highlight-k">finally</span> <span class="highlight-o">{</span>
            <span class="highlight-c1">//5.释放连接
</span><span class="highlight-c1"></span>            <span class="highlight-n">txManager</span><span class="highlight-o">.</span><span class="highlight-na">release</span><span class="highlight-o">();</span>
        <span class="highlight-o">}</span>
    <span class="highlight-o">}</span>
<span class="highlight-o">}</span>
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="9--基于子类的动态代理">9. 基于子类的动态代理</h3>
<ul>
<li>动态代理：
<ul>
<li>特点：字节码随用随创建，随用随加载</li>
<li>作用：不修改源码的基础上对方法增强</li>
<li>分类：
<ul>
<li>基于接口的动态代理</li>
<li>基于子类的动态代理</li>
</ul>
</li>
<li>基于子类的动态代理：
<ul>
<li>涉及的类：Enhancer</li>
<li>提供者：第三方 cglib 库</li>
</ul>
</li>
<li>如何创建代理对象：
<ul>
<li>使用 Enhancer 类中的 create 方法</li>
</ul>
</li>
<li>创建代理对象的要求：
<ul>
<li>被代理类不能是最终类</li>
</ul>
</li>
<li>create 方法的参数：
<ul>
<li>Class：被代理对象的字节码
<ul>
<li>它是用于指定被代理对象的字节码。</li>
</ul>
</li>
<li>Callback：用于提供增强的代码
<ul>
<li>它是让我们写如何代理。我们一般都是些一个该接口的实现类，通常情况下都是匿名内部类，但不是必须的。</li>
<li>我们一般写的都是该接口的子接口实现类：MethodInterceptor</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<pre><code class="language-java highlight-chroma">   <span class="highlight-kn">package</span> <span class="highlight-nn">cglib</span><span class="highlight-o">;</span>


   <span class="highlight-kn">import</span> <span class="highlight-nn">net.sf.cglib.proxy.Enhancer</span><span class="highlight-o">;</span>
   <span class="highlight-kn">import</span> <span class="highlight-nn">net.sf.cglib.proxy.MethodInterceptor</span><span class="highlight-o">;</span>
   <span class="highlight-kn">import</span> <span class="highlight-nn">net.sf.cglib.proxy.MethodProxy</span><span class="highlight-o">;</span>

   <span class="highlight-kn">import</span> <span class="highlight-nn">java.lang.reflect.Method</span><span class="highlight-o">;</span>

   <span class="highlight-kd">public</span> <span class="highlight-kd">class</span> <span class="highlight-nc">Client</span> <span class="highlight-o">{</span>

       <span class="highlight-kd">public</span> <span class="highlight-kd">static</span> <span class="highlight-kt">void</span> <span class="highlight-nf">main</span><span class="highlight-o">(</span><span class="highlight-n">String</span><span class="highlight-o">[]</span> <span class="highlight-n">args</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
           <span class="highlight-kd">final</span> <span class="highlight-n">Producer</span> <span class="highlight-n">producer</span> <span class="highlight-o">=</span> <span class="highlight-k">new</span> <span class="highlight-n">Producer</span><span class="highlight-o">();</span>
           <span class="highlight-n">Producer</span> <span class="highlight-n">cglibProducer</span> <span class="highlight-o">=</span> <span class="highlight-o">(</span><span class="highlight-n">Producer</span><span class="highlight-o">)</span> <span class="highlight-n">Enhancer</span><span class="highlight-o">.</span><span class="highlight-na">create</span><span class="highlight-o">(</span><span class="highlight-n">producer</span><span class="highlight-o">.</span><span class="highlight-na">getClass</span><span class="highlight-o">(),</span> <span class="highlight-k">new</span> <span class="highlight-n">MethodInterceptor</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
               <span class="highlight-nd">@Override</span>
               <span class="highlight-kd">public</span> <span class="highlight-n">Object</span> <span class="highlight-nf">intercept</span><span class="highlight-o">(</span><span class="highlight-n">Object</span> <span class="highlight-n">o</span><span class="highlight-o">,</span> <span class="highlight-n">Method</span> <span class="highlight-n">method</span><span class="highlight-o">,</span> <span class="highlight-n">Object</span><span class="highlight-o">[]</span> <span class="highlight-n">objects</span><span class="highlight-o">,</span> <span class="highlight-n">MethodProxy</span> <span class="highlight-n">methodProxy</span><span class="highlight-o">)</span> <span class="highlight-kd">throws</span> <span class="highlight-n">Throwable</span> <span class="highlight-o">{</span>
                   <span class="highlight-n">Object</span> <span class="highlight-n">returnValue</span> <span class="highlight-o">=</span> <span class="highlight-kc">null</span><span class="highlight-o">;</span>
                   <span class="highlight-n">Float</span> <span class="highlight-n">money</span> <span class="highlight-o">=</span> <span class="highlight-o">(</span><span class="highlight-n">Float</span><span class="highlight-o">)</span> <span class="highlight-n">objects</span><span class="highlight-o">[</span><span class="highlight-n">0</span><span class="highlight-o">];</span>

                   <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-s">"saleProduct"</span><span class="highlight-o">.</span><span class="highlight-na">equals</span><span class="highlight-o">(</span><span class="highlight-n">method</span><span class="highlight-o">.</span><span class="highlight-na">getName</span><span class="highlight-o">()))</span> <span class="highlight-o">{</span>
                       <span class="highlight-n">returnValue</span> <span class="highlight-o">=</span> <span class="highlight-n">method</span><span class="highlight-o">.</span><span class="highlight-na">invoke</span><span class="highlight-o">(</span><span class="highlight-n">producer</span><span class="highlight-o">,</span> <span class="highlight-n">money</span> <span class="highlight-o">*</span> <span class="highlight-n">0</span><span class="highlight-o">.</span><span class="highlight-na">8f</span><span class="highlight-o">);</span>
                   <span class="highlight-o">}</span>
                   <span class="highlight-k">return</span> <span class="highlight-n">returnValue</span><span class="highlight-o">;</span>
               <span class="highlight-o">}</span>
           <span class="highlight-o">});</span>
           <span class="highlight-n">cglibProducer</span><span class="highlight-o">.</span><span class="highlight-na">saleProduct</span><span class="highlight-o">(</span><span class="highlight-n">12000</span><span class="highlight-o">);</span>
       <span class="highlight-o">}</span>
   <span class="highlight-o">}</span>
</code></pre>
</li>
</ul>
<h3 id="10--AOP-面向切面编程">10. AOP 面向切面编程</h3>
<ul>
<li>
<p>AOP：简单的说它就是把我们程序重复的代码抽取出来，在需要执行的时候，使用动态代理的技术，在不修改源码的基础上，对我们的已有方法进行增强。</p>
</li>
<li>
<p>AOP 的作用：在程序运行期间，不修改源码对已有方法进行增强。</p>
</li>
<li>
<p>AOP 的实现方式：使用动态代理技术。</p>
</li>
<li>
<p>AOP 相关术语：</p>
<ul>
<li>Joinpoint (连接点)：所谓连接点是指那些被拦截到的点。在 Spring 中，这些点指的是方法，因为 Spring 只支持方法类型的连接点。</li>
<li>Pointcut (切入点)：所谓切入点是指我们要对哪些 Joinpoint 进行拦截的定义。</li>
<li>Advice (通知/增强)：所谓通知是指拦截到 Joinpoint 之后所要做的事情就是通知。
<ul>
<li>通知的类型：前置通知，后置通知，异常通知，最终通知，环绕通知。</li>
<li><img src="https://raw.githubusercontent.com/Rainsheep/pic-bed/master/img/2020-03-07+23:29:03+%E9%80%9A%E7%9F%A5%E7%9A%84%E7%B1%BB%E5%9E%8B.jpg" alt=""></li>
</ul>
</li>
<li>Introduction (引介)：引介是一种特殊的通知在不修改类代码的前提下，Introduction 可以在运行期为类动态地添加一些方法或 Field。</li>
<li>Target (目标对象)：代理的目标对象。</li>
<li>Weaving (织入)：是指把增强应用到目标对象来创建新的代理对象的过程。Spring 采用动态代理织入，而 AspectJ 采用编译期织入和类装载期织入。</li>
<li>Proxy (代理)：一个类被 AOP 织入增强后，就产生一个结果代理类。</li>
<li>Aspect (切面)：是切入点和通知(引介)的结合。</li>
</ul>
</li>
<li>
<p>基于 XML 的 AOP 配置步骤</p>
<ol>
<li>导入解析切入点表达式的 jar 包
<pre><code class="language-xml highlight-chroma"><span class="highlight-nt">&lt;dependency&gt;</span>
    <span class="highlight-nt">&lt;groupId&gt;</span>org.aspectj<span class="highlight-nt">&lt;/groupId&gt;</span>
    <span class="highlight-nt">&lt;artifactId&gt;</span>aspectjweaver<span class="highlight-nt">&lt;/artifactId&gt;</span>
    <span class="highlight-nt">&lt;version&gt;</span>1.8.7<span class="highlight-nt">&lt;/version&gt;</span>
<span class="highlight-nt">&lt;/dependency&gt;</span>
</code></pre>
</li>
<li>使用 aop:config 标签表明开始 AOP 的配置</li>
<li>使用 aop:aspect 标签表明配置切面
<ul>
<li>id 属性：是给切面提供一个唯一标识</li>
<li>ref 属性：是指定通知类 bean 的 Id。</li>
</ul>
</li>
<li>在 aop:aspect 标签的内部使用对应标签来配置通知的类型
<ul>
<li>aop:before：表示配置前置通知</li>
<li>aop:after-returning：后置通知</li>
<li>aop:after-throwing：异常通知</li>
<li>aop:after：最终通知
<ul>
<li>method 属性：用于指定类中哪个方法是前置通知</li>
<li>pointcut 属性：用于指定切入点表达式，该表达式的含义指的是对业务层中哪些方法增强</li>
</ul>
</li>
</ul>
</li>
</ol>
<pre><code class="language-xml highlight-chroma"><span class="highlight-c">&lt;!-- 配置通知类 --&gt;</span>
<span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"logger"</span> <span class="highlight-na">class=</span><span class="highlight-s">"com.itheima.utils.Logger"</span><span class="highlight-nt">&gt;&lt;/bean&gt;</span>
<span class="highlight-c">&lt;!--配置AOP--&gt;</span>
<span class="highlight-nt">&lt;aop:config&gt;</span>
    <span class="highlight-c">&lt;!--配置切面 --&gt;</span>
    <span class="highlight-nt">&lt;aop:aspect</span> <span class="highlight-na">id=</span><span class="highlight-s">"logAdvice"</span> <span class="highlight-na">ref=</span><span class="highlight-s">"logger"</span><span class="highlight-nt">&gt;</span>
        <span class="highlight-c">&lt;!-- 配置通知的类型，并且建立通知方法和切入点方法的关联--&gt;</span>
        <span class="highlight-nt">&lt;aop:before</span> <span class="highlight-na">method=</span><span class="highlight-s">"printLog"</span> <span class="highlight-na">pointcut=</span><span class="highlight-s">"execution(* service.impl.*.*(..))"</span><span class="highlight-nt">&gt;&lt;/aop:before&gt;</span>
    <span class="highlight-nt">&lt;/aop:aspect&gt;</span>
<span class="highlight-nt">&lt;/aop:config&gt;</span>
</code></pre>
</li>
<li>
<p>切入点表达式的写法</p>
<ul>
<li>关键字：execution(表达式)</li>
<li>表达式：访问修饰符  返回值  包名。包名...类名。方法名(参数列表)</li>
<li>标准的表达式写法：<code>public void pers.ylq.service.impl.AccountServiceImpl.saveAccount()</code></li>
<li>访问修饰符可以省略</li>
<li>返回值可以使用通配符(*)，表示任意返回值</li>
<li>包名可以使用通配符，表示任意包。但是有几级包，就需要写几个*.
<ul>
<li><code>* *.*.*.*.AccountServiceImpl.saveAccount())</code></li>
</ul>
</li>
<li>包名可以使用 <code>..</code> 表示当前包及其子包
<ul>
<li><code>* *..AccountServiceImpl.saveAccount()</code></li>
</ul>
</li>
<li>类名和方法名都可以使用*来实现通配
<ul>
<li><code>* *..*.*()</code></li>
</ul>
</li>
<li>参数列表：
<ul>
<li>基本类型直接写名称：int</li>
<li>引用类型写包名。类名的方式：java.lang.String</li>
<li>可以使用通配符表示任意类型，但是必须有参数</li>
<li>可以使用 <code>..</code> 表示有无参数均可，有参数可以是任意类型</li>
</ul>
</li>
<li>全通配写法：<code>* *..*.*(..)</code></li>
<li>实际开发中切入点表达式的通常写法：
<ul>
<li>切到业务层实现类下的所有方法：<code>* pers.ylq.service.impl.*.*(..)</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>aop:pointcut 可以配置切入表达式，在通知标签中，通过 pointcut-ref 属性引入</p>
<pre><code class="highlight-chroma">&lt;aop:pointcut id="pt1" expression="execution(* pers.ylq.service.impl.*.*(..))"/&gt;
</code></pre>
<ul>
<li>此标签写在 aop:aspect 内部只能当前切面使用。</li>
<li>写在 aop:aspect 外面，所以切面可用，但是要写在所以切面配置的前面。</li>
</ul>
</li>
<li>
<p>环绕通知：它是 Spring 框架为我们提供的一种可以在代码中手动控制增强方法何时执行的方式。</p>
</li>
<li>
<p>Spring 框架为我们提供了一个接口：ProceedingJoinPoint。该接口有一个方法 proceed()，此方法就相当于明确调用切入点方法。该接口可以作为环绕通知的方法参数，在程序执行时，Spring 框架会为我们提供该接口的实现类供我们使用。</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-o">&lt;</span><span class="highlight-n">aop</span><span class="highlight-o">:</span><span class="highlight-n">around</span> <span class="highlight-n">method</span><span class="highlight-o">=</span><span class="highlight-s">"aroundPringLog"</span> <span class="highlight-n">pointcut</span><span class="highlight-o">=</span><span class="highlight-s">"execution(* service.impl.*.*(..))"</span><span class="highlight-o">&gt;&lt;/</span><span class="highlight-n">aop</span><span class="highlight-o">:</span><span class="highlight-n">around</span><span class="highlight-o">&gt;</span>

<span class="highlight-kd">public</span> <span class="highlight-n">Object</span> <span class="highlight-nf">aroundPringLog</span><span class="highlight-o">(</span><span class="highlight-n">ProceedingJoinPoint</span> <span class="highlight-n">pjp</span><span class="highlight-o">){</span>
    <span class="highlight-n">Object</span> <span class="highlight-n">rtValue</span> <span class="highlight-o">=</span> <span class="highlight-kc">null</span><span class="highlight-o">;</span>
    <span class="highlight-k">try</span><span class="highlight-o">{</span>
        <span class="highlight-n">Object</span><span class="highlight-o">[]</span> <span class="highlight-n">args</span> <span class="highlight-o">=</span> <span class="highlight-n">pjp</span><span class="highlight-o">.</span><span class="highlight-na">getArgs</span><span class="highlight-o">();</span><span class="highlight-c1">//得到方法执行所需的参数
</span><span class="highlight-c1"></span>        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"前置通知"</span><span class="highlight-o">);</span>
        <span class="highlight-n">rtValue</span> <span class="highlight-o">=</span> <span class="highlight-n">pjp</span><span class="highlight-o">.</span><span class="highlight-na">proceed</span><span class="highlight-o">(</span><span class="highlight-n">args</span><span class="highlight-o">);</span><span class="highlight-c1">//明确调用业务层方法（切入点方法）
</span><span class="highlight-c1"></span>        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"后置通知"</span><span class="highlight-o">);</span>
        <span class="highlight-k">return</span> <span class="highlight-n">rtValue</span><span class="highlight-o">;</span>
    <span class="highlight-o">}</span><span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Throwable</span> <span class="highlight-n">t</span><span class="highlight-o">){</span>
        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"异常通知"</span><span class="highlight-o">);</span>
        <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">t</span><span class="highlight-o">);</span>
    <span class="highlight-o">}</span><span class="highlight-k">finally</span> <span class="highlight-o">{</span>
        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"最终通知"</span><span class="highlight-o">);</span>
    <span class="highlight-o">}</span>
<span class="highlight-o">}</span>
</code></pre>
</li>
<li>
<p>AOP 注解：</p>
<ul>
<li>aop:aspectj-autoproxy 标签：配置 Spring 开启注解 AOP 的支持。</li>
<li>@Aspect：表示当前类是一个切面类</li>
<li>@Pointcut：配置切入点表达式</li>
<li>@Before：前置通知</li>
<li>@AfterReturning：后置通知</li>
<li>@AfterThrowing：异常通知</li>
<li>@After：最终通知</li>
<li>@Around：环绕通知</li>
<li>
<pre><code class="language-java highlight-chroma"><span class="highlight-nd">@Component</span><span class="highlight-o">(</span><span class="highlight-s">"logger"</span><span class="highlight-o">)</span>
<span class="highlight-nd">@Aspect</span>
<span class="highlight-kd">public</span> <span class="highlight-kd">class</span> <span class="highlight-nc">Logger</span> <span class="highlight-o">{</span>

    <span class="highlight-nd">@Pointcut</span><span class="highlight-o">(</span><span class="highlight-s">"execution(* pers.ylq.service.impl.*.*(..))"</span><span class="highlight-o">)</span>
    <span class="highlight-kd">private</span> <span class="highlight-kt">void</span> <span class="highlight-nf">pt1</span><span class="highlight-o">(){}</span>

    <span class="highlight-nd">@Before</span><span class="highlight-o">(</span><span class="highlight-s">"pt1()"</span><span class="highlight-o">)</span>
    <span class="highlight-kd">public</span>  <span class="highlight-kt">void</span> <span class="highlight-nf">beforePrintLog</span><span class="highlight-o">(){</span>
        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"前置通知"</span><span class="highlight-o">);</span>
    <span class="highlight-o">}</span>
    <span class="highlight-nd">@AfterReturning</span><span class="highlight-o">(</span><span class="highlight-s">"pt1()"</span><span class="highlight-o">)</span>
    <span class="highlight-kd">public</span>  <span class="highlight-kt">void</span> <span class="highlight-nf">afterReturningPrintLog</span><span class="highlight-o">(){</span>
        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"后置通知"</span><span class="highlight-o">);</span>
    <span class="highlight-o">}</span>

    <span class="highlight-nd">@AfterThrowing</span><span class="highlight-o">(</span><span class="highlight-s">"pt1()"</span><span class="highlight-o">)</span>
    <span class="highlight-kd">public</span>  <span class="highlight-kt">void</span> <span class="highlight-nf">afterThrowingPrintLog</span><span class="highlight-o">(){</span>
        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"异常通知"</span><span class="highlight-o">);</span>
    <span class="highlight-o">}</span>


    <span class="highlight-nd">@After</span><span class="highlight-o">(</span><span class="highlight-s">"pt1()"</span><span class="highlight-o">)</span>
    <span class="highlight-kd">public</span>  <span class="highlight-kt">void</span> <span class="highlight-nf">afterPrintLog</span><span class="highlight-o">(){</span>
        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"最终通知"</span><span class="highlight-o">);</span>
    <span class="highlight-o">}</span>
<span class="highlight-o">}</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p>使用注解的时候，当我们不是呀环绕通知的时候，Spring 自带通知的执行顺序为 前置通知--&gt; 最终通知--&gt; 后置/异常通知，也就是说最终通知在后置通知和异常通知之前执行，是错误的，我们需要注意。</p>
</li>
<li>
<p>不使用 XML 的配置方式：@EnableAspectJAutoProxy</p>
</li>
</ul>
<h3 id="11--JdbcTemplate">11. JdbcTemplate</h3>
<ul>
<li>所需 jar 包
<ul>
<li><code> spring-jdbc-5.0.2.RELEASE.jar</code></li>
<li><code>spring-tx-5.0.2.RELEASE.jar</code> 和事务相关</li>
<li>
<pre><code class="language-xml highlight-chroma"><span class="highlight-nt">&lt;dependency&gt;</span>
    <span class="highlight-nt">&lt;groupId&gt;</span>mysql<span class="highlight-nt">&lt;/groupId&gt;</span>
    <span class="highlight-nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="highlight-nt">&lt;/artifactId&gt;</span>
    <span class="highlight-nt">&lt;version&gt;</span>5.1.6<span class="highlight-nt">&lt;/version&gt;</span>
<span class="highlight-nt">&lt;/dependency&gt;</span>
<span class="highlight-nt">&lt;dependency&gt;</span>
    <span class="highlight-nt">&lt;groupId&gt;</span>org.springframework<span class="highlight-nt">&lt;/groupId&gt;</span>
    <span class="highlight-nt">&lt;artifactId&gt;</span>spring-context<span class="highlight-nt">&lt;/artifactId&gt;</span>
    <span class="highlight-nt">&lt;version&gt;</span>5.0.2.RELEASE<span class="highlight-nt">&lt;/version&gt;</span>
<span class="highlight-nt">&lt;/dependency&gt;</span>
<span class="highlight-nt">&lt;dependency&gt;</span>
    <span class="highlight-nt">&lt;groupId&gt;</span>org.springframework<span class="highlight-nt">&lt;/groupId&gt;</span>
    <span class="highlight-nt">&lt;artifactId&gt;</span>spring-jdbc<span class="highlight-nt">&lt;/artifactId&gt;</span>
    <span class="highlight-nt">&lt;version&gt;</span>5.0.2.RELEASE<span class="highlight-nt">&lt;/version&gt;</span>
<span class="highlight-nt">&lt;/dependency&gt;</span>
<span class="highlight-nt">&lt;dependency&gt;</span>
    <span class="highlight-nt">&lt;groupId&gt;</span>org.springframework<span class="highlight-nt">&lt;/groupId&gt;</span>
    <span class="highlight-nt">&lt;artifactId&gt;</span>spring-tx<span class="highlight-nt">&lt;/artifactId&gt;</span>
    <span class="highlight-nt">&lt;version&gt;</span>5.0.2.RELEASE<span class="highlight-nt">&lt;/version&gt;</span>
<span class="highlight-nt">&lt;/dependency&gt;</span>
</code></pre>
</li>
</ul>
</li>
<li>Spring 内置数据库连接池
<pre><code class="language-java highlight-chroma"><span class="highlight-n">DriverManagerDataSource</span> <span class="highlight-n">ds</span> <span class="highlight-o">=</span> <span class="highlight-k">new</span> <span class="highlight-n">DriverManagerDataSource</span><span class="highlight-o">();</span>
<span class="highlight-n">ds</span><span class="highlight-o">.</span><span class="highlight-na">setDriverClassName</span><span class="highlight-o">(</span><span class="highlight-s">"com.mysql.jdbc.Driver"</span><span class="highlight-o">);</span>
<span class="highlight-n">ds</span><span class="highlight-o">.</span><span class="highlight-na">setUrl</span><span class="highlight-o">(</span><span class="highlight-s">"jdbc:mysql://localhost:3306/eesy"</span><span class="highlight-o">);</span>
<span class="highlight-n">ds</span><span class="highlight-o">.</span><span class="highlight-na">setUsername</span><span class="highlight-o">(</span><span class="highlight-s">"root"</span><span class="highlight-o">);</span>
<span class="highlight-n">ds</span><span class="highlight-o">.</span><span class="highlight-na">setPassword</span><span class="highlight-o">(</span><span class="highlight-s">"123456"</span><span class="highlight-o">);</span>
</code></pre>
</li>
<li>构造方法：
<ul>
<li><code>JdbcTemplate();</code></li>
<li><code>JdbcTemplate(DataSource ds);</code></li>
</ul>
</li>
<li>常用方法：
<ul>
<li><code>setDataSource(DataSource ds);</code> 设置数据源</li>
<li><code>update(String sql,Object... args);</code></li>
<li><code>query(String sql,RowMapper&lt;T&gt; rowmapper,Object... args);</code></li>
<li><code>queryForObject(String sql,RowMapper&lt;T&gt; rowmapper,Object... args);</code></li>
<li><code>queryForObject(String sql,Class&lt;T&gt; requiredType,Object... args);</code></li>
</ul>
</li>
<li>JdbcTemplate 提供了 RowMapper 的子类 <code>new BeanPropertyRowMapper&lt;&gt;(Class&lt;T&gt; mappedClass)</code> 来进行数据的封装。</li>
<li>当多个 dao 层的类使用 JdbcTemplate 操作的时候，可以继承 JdbcDaoSupport，由官方提供，里面有 JdbcTemplate，我们无需重复定义，只是使用继承的时候没办法用注解注入值。</li>
</ul>
<h3 id="12--事务控制">12. 事务控制</h3>
<ul>
<li>
<p>Spring 的事务控制在业务层。</p>
</li>
<li>
<p>Spring 的事务控制是基于 AOP 的。</p>
</li>
<li>
<p>Spring 中事务的 API</p>
<ul>
<li>PlatformTransactionManager：此接口是 Spring 的事务管理器，它里面提供了我们常用的操作事务的方法。
<ul>
<li><code>TransactionStatus getTransaction(TransactionDefinition definition)</code> 获取事务状态信息</li>
<li><code>void commit(TransactionStatus status)</code> 提交事务</li>
<li><code>void rollback(TransactionStatus status)</code> 回滚事务</li>
<li>我们在开发中都是使用它的实现类
<ul>
<li><code>org.springframework.jdbc.datasource.DataSourceTransactionManager</code>  使用 Spring<br>
JDBC 或 或 iBatis  进行持久化数据时使用</li>
<li><code>org.springframework.orm.hibernate5.HibernateTransactionManager</code> 使用<br>
Hibernate</li>
</ul>
</li>
</ul>
</li>
<li>TransactionDefinition：它是事务的定义信息对象
<ul>
<li><code>String getName()</code> 获取事务对象名称</li>
<li><code>int getIsolationLevel()</code> 获取事务隔离级别</li>
<li><code>int getPropagationBehavior()</code> 获取事务传播行为</li>
<li><code>int getTimeout()</code> 获取事务超时时间</li>
<li><code>boolean isReadOnly()</code> 获取事务是否只读</li>
</ul>
</li>
<li>TransactionStatus：此接口提供的是事务具体的运行状态
<ul>
<li><code>void flush()</code> 刷新事务</li>
<li><code>boolean hasSavepoint()</code> 获取是否存在存储点</li>
<li><code>boolean isCompleted()</code> 获取事务是否完成</li>
<li><code>boolean isNewTransaction()</code> 获取事务是否为新事务</li>
<li><code>boolean isRollbackOnly()</code> 获取事务是否回滚</li>
<li><code>void setRollbackOnly()</code> 设置事务回滚</li>
</ul>
</li>
</ul>
</li>
<li>
<p>事务的传播行为：</p>
<ul>
<li>REQUIRED：如果当前没有事务，就新建一个事务，如果已经存在一个事务中，加入到这个事务中。一般的选择（默认值），增删改用这个</li>
<li>SUPPORTS：支持当前事务，如果当前没有事务，就以非事务方式执行（没有事务），查询用这个</li>
</ul>
</li>
<li>
<p>So? 以上 API 我们通过配置文件实现。。。</p>
</li>
<li>
<p>基于 XML 的声明式事务控制配置步骤</p>
<ol>
<li>配置事务管理器</li>
<li>配置事务的通知
<ul>
<li>此时我们需要导入事务的约束 tx 名称空间和约束，同时也需要 aop 的</li>
<li>使用 tx:advice 标签配置事务通知
<ul>
<li>属性 id：给事务通知起一个唯一标识</li>
<li>transaction-manager：给事务通知提供一个事务管理器引用</li>
</ul>
</li>
</ul>
</li>
<li>配置 AOP 中的通用切入点表达式</li>
<li>建立事务通知和切入点表达式的对应关系</li>
<li>配置事务的属性
<ul>
<li>在事务的通知 tx:advice 标签的内部</li>
<li>isolation：用于指定事务的隔离级别。默认值是 DEFAULT，表示使用数据库的默认隔离级别。</li>
<li>propagation：用于指定事务的传播行为。默认值是 REQUIRED，表示一定会有事务，增删改的选择。查询方法可以选择 SUPPORTS。</li>
<li>read-only：用于指定事务是否只读。只有查询方法才能设置为 true。默认值是 false，表示读写。</li>
<li>timeout：用于指定事务的超时时间，默认值是-1，表示永不超时。如果指定了数值，以秒为单位。</li>
<li>rollback-for：用于指定一个异常，当产生该异常时，事务回滚，产生其他异常时，事务不回滚。没有默认值。表示任何异常都回滚。</li>
<li>no-rollback-for：用于指定一个异常，当产生该异常时，事务不回滚，产生其他异常时事务回滚。没有默认值。表示任何异常都回滚。</li>
</ul>
</li>
</ol>
<pre><code class="language-xml highlight-chroma"><span class="highlight-c">&lt;!-- 配置事务管理器 --&gt;</span>
<span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"transactionManager"</span> <span class="highlight-na">class=</span><span class="highlight-s">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="highlight-nt">&gt;</span>
    <span class="highlight-nt">&lt;property</span> <span class="highlight-na">name=</span><span class="highlight-s">"dataSource"</span> <span class="highlight-na">ref=</span><span class="highlight-s">"dataSource"</span><span class="highlight-nt">&gt;&lt;/property&gt;</span>
<span class="highlight-nt">&lt;/bean&gt;</span>

<span class="highlight-c">&lt;!-- 配置事务的通知--&gt;</span>
<span class="highlight-nt">&lt;tx:advice</span> <span class="highlight-na">id=</span><span class="highlight-s">"txAdvice"</span> <span class="highlight-na">transaction-manager=</span><span class="highlight-s">"transactionManager"</span><span class="highlight-nt">&gt;</span>
    <span class="highlight-c">&lt;!-- 配置事务的属性--&gt;</span>
    <span class="highlight-nt">&lt;tx:attributes&gt;</span>
        <span class="highlight-nt">&lt;tx:method</span> <span class="highlight-na">name=</span><span class="highlight-s">"*"</span> <span class="highlight-na">propagation=</span><span class="highlight-s">"REQUIRED"</span> <span class="highlight-na">read-only=</span><span class="highlight-s">"false"</span><span class="highlight-nt">/&gt;</span>
        <span class="highlight-nt">&lt;tx:method</span> <span class="highlight-na">name=</span><span class="highlight-s">"find*"</span> <span class="highlight-na">propagation=</span><span class="highlight-s">"SUPPORTS"</span> <span class="highlight-na">read-only=</span><span class="highlight-s">"true"</span><span class="highlight-nt">&gt;&lt;/tx:method&gt;</span>
    <span class="highlight-nt">&lt;/tx:attributes&gt;</span>
<span class="highlight-nt">&lt;/tx:advice&gt;</span>

<span class="highlight-c">&lt;!-- 配置aop--&gt;</span>
<span class="highlight-nt">&lt;aop:config&gt;</span>
    <span class="highlight-c">&lt;!-- 配置切入点表达式--&gt;</span>
    <span class="highlight-nt">&lt;aop:pointcut</span> <span class="highlight-na">id=</span><span class="highlight-s">"pt1"</span> <span class="highlight-na">expression=</span><span class="highlight-s">"execution(* pers.ylq.service.impl.*.*(..))"</span><span class="highlight-nt">&gt;&lt;/aop:pointcut&gt;</span>
    <span class="highlight-c">&lt;!--建立切入点表达式和事务通知的对应关系 --&gt;</span>
    <span class="highlight-nt">&lt;aop:advisor</span> <span class="highlight-na">advice-ref=</span><span class="highlight-s">"txAdvice"</span> <span class="highlight-na">pointcut-ref=</span><span class="highlight-s">"pt1"</span><span class="highlight-nt">&gt;&lt;/aop:advisor&gt;</span>
<span class="highlight-nt">&lt;/aop:config&gt;</span>
</code></pre>
</li>
<li>
<p>基于注解的配置方式：</p>
<ul>
<li>第一步：配置事务管理器并注入数据源
<pre><code class="language-xml highlight-chroma"><span class="highlight-nt">&lt;bean</span> <span class="highlight-na">id=</span><span class="highlight-s">"transactionManager"</span> <span class="highlight-na">class=</span><span class="highlight-s">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="highlight-nt">&gt;</span>
    <span class="highlight-nt">&lt;property</span> <span class="highlight-na">name=</span><span class="highlight-s">"dataSource"</span> <span class="highlight-na">ref=</span><span class="highlight-s">"dataSource"</span><span class="highlight-nt">/&gt;</span>
<span class="highlight-nt">&lt;/bean&gt;</span>
</code></pre>
</li>
<li>第二步：开启 Spring 对注解事务的支持
<pre><code class="language-xml highlight-chroma"><span class="highlight-nt">&lt;tx:annotation-driven</span> <span class="highlight-na">transaction-manager=</span><span class="highlight-s">"transactionManager"</span><span class="highlight-nt">&gt;&lt;/tx:annotation-driven&gt;</span>
</code></pre>
</li>
<li>第三步：在需要事务支持的地方(业务层类上)使用 @Transactional 注解
<ul>
<li>其属性可以配置事务</li>
</ul>
</li>
</ul>
</li>
<li>
<p>@EnableTransactionManagement 注解，可以以不使用 XML 的方式开启 Spring 对注解事务的支持。</p>
</li>
</ul>
                            <div>
                                <hr>

标题：Spring 学习笔记<br>
作者：<a href="https://Rainsheep.github.io" target="_blank">Rainsheep</a><br>
地址：<a href="https://Rainsheep.github.io/articles/2020/03/08/1583653357274.html" target="_blank">https://Rainsheep.github.io/articles/2020/03/08/1583653357274.html</a><br>

<!-- 签名档内可使用 HTML、JavaScript -->
<br>
                            </div>
                    </div>
                </div>
            </div>

                <div class="module mobile__hidden">
                    <div class="module__content fn__clear">
                            <a href="https://Rainsheep.github.io/articles/2020/03/06/1583434614785.html" rel="prev" class="fn__left breadcrumb">
                                旧一篇: mybatis 学习笔记
                            </a>
                            <a href="https://Rainsheep.github.io/articles/2020/03/09/1583763466425.html" rel="next"
                               class="fn__right breadcrumb">
                                Linux 学习笔记: 新一篇
                            </a>
                    </div>
                </div>

                <div class="module mobile__hidden fn__none">
                    <div class="module__content">
                        <a href="https://Rainsheep.github.io/articles/2020/03/06/1583434614785.html" rel="prev" class="breadcrumb">
                            旧一篇: mybatis 学习笔记
                        </a>
                    </div>
                </div>

                <div class="module mobile__hidden fn__none">
                    <div class="module__content">
                        <a href="https://Rainsheep.github.io/articles/2020/03/09/1583763466425.html" rel="next"
                           class="breadcrumb">
                            新一篇: Linux 学习笔记
                        </a>
                    </div>
                </div>
                <div id="b3logsolocomments"></div>
                <div id="vcomment" class="module__content"
                     style="border-radius: 5px;margin-bottom: 30px;box-shadow: 1px 1px 3px 1px rgba(0,0,0,0.2);transition: all .3s;"
                     data-name="Rainsheep" data-postId="1583653357274"></div>

            <div class="fn__flex article__relevant">
                <div class="fn__flex-1" id="externalRelevantArticlesWrap">
                    <div class="module">
                        <div id="externalRelevantArticles" class="module__list"></div>
                    </div>
                </div>
                <div class="mobile__hidden">&nbsp; &nbsp; &nbsp; &nbsp;</div>
                <div class="fn__flex-1" id="randomArticlesWrap">
                    <div class="module">
                        <div id="randomArticles" class="module__list"></div>
                    </div>
                </div>
                <div class="mobile__hidden">&nbsp; &nbsp; &nbsp; &nbsp;</div>
                <div class="fn__flex-1" id="relevantArticlesWrap">
                    <div class="module">
                        <div id="relevantArticles" class="module__list"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
<aside class="side">
        <div class="module">
            <div class="module__list">
<ul class="article__toc">
        <li class="toc__h3">
            <a href="#1--Spring-框架了解">1. Spring 框架了解</a>
        </li>
        <li class="toc__h3">
            <a href="#2--工厂模式解耦">2. 工厂模式解耦</a>
        </li>
        <li class="toc__h3">
            <a href="#3--IoC-反转控制">3. IoC 反转控制</a>
        </li>
        <li class="toc__h3">
            <a href="#4--DI-依赖注入">4. DI 依赖注入</a>
        </li>
        <li class="toc__h3">
            <a href="#5--Spring-的常用注解">5. Spring 的常用注解</a>
        </li>
        <li class="toc__h3">
            <a href="#6--Spring-新注解">6. Spring 新注解</a>
        </li>
        <li class="toc__h3">
            <a href="#7--Spring-整合-Junit">7. Spring 整合 Junit</a>
        </li>
        <li class="toc__h3">
            <a href="#8--银行转账案例">8. 银行转账案例</a>
        </li>
        <li class="toc__h3">
            <a href="#9--基于子类的动态代理">9. 基于子类的动态代理</a>
        </li>
        <li class="toc__h3">
            <a href="#10--AOP-面向切面编程">10. AOP 面向切面编程</a>
        </li>
        <li class="toc__h3">
            <a href="#11--JdbcTemplate">11. JdbcTemplate</a>
        </li>
        <li class="toc__h3">
            <a href="#12--事务控制">12. 事务控制</a>
        </li>
</ul>            </div>
        </div>
        <section class="vditor-reset module">
            <main class="module__content">
                <b><i><font><span id="hitokoto">欢迎来到Rain sheep的博客</span></font></i></b>
<script src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto" defer></script>
<!-- 公告栏可使用 HTML、JavaScript，比如可以在此加入第三方统计 js -->
            </main>
        </section>


    <div class="module item">
        <header class="module__header ft__center">
            Rainsheep
        </header>
        <main class="module__content ft__center">
            <img class="side__avatar" src="https://img.hacpai.com/avatar/1573792699119_1577275046042.jpeg?imageView2/1/w/128/h/128/interlace/0/q/100" alt="Rainsheep"/>
            咸鱼不配拥有梦想 <br> <br>
    <a href="https://hacpai.com/member/Rainsheep"
       title="https://hacpai.com/member/Rainsheep"
       class="user__site"
       target="_blank" rel="noopener nofollow">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path fill="#d23f31" style="fill: var(--color1, #d23f31)" d="M5.787 17.226h17.033l5.954 9.528c0.47 0.752 0.003 1.361-1.042 1.361h-15.141z"></path>
            <path d="M10.74 3.927h17.033c1.045 0 1.512 0.609 1.042 1.361l-5.954 9.528h-19.872l6.379-10.209c0.235-0.376 0.849-0.681 1.372-0.681z"></path>
            <path d="M2.953 17.226h2.839l6.804 10.889h-1.892c-0.523 0-1.137-0.305-1.372-0.681z"></path>
        </svg>
    </a>

        <a href="https://github.com/Rainsheep"
           title="https://github.com/Rainsheep"
           class="user__site"
           target="_blank" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M16 0.331c-8.836 0-16 7.163-16 16 0 7.069 4.585 13.067 10.942 15.182 0.8 0.148 1.094-0.347 1.094-0.77 0-0.381-0.015-1.642-0.022-2.979-4.452 0.968-5.391-1.888-5.391-1.888-0.728-1.849-1.776-2.341-1.776-2.341-1.452-0.993 0.11-0.973 0.11-0.973 1.606 0.113 2.452 1.649 2.452 1.649 1.427 2.446 3.743 1.739 4.656 1.33 0.143-1.034 0.558-1.74 1.016-2.14-3.554-0.404-7.29-1.777-7.29-7.907 0-1.747 0.625-3.174 1.649-4.295-0.166-0.403-0.714-2.030 0.155-4.234 0 0 1.344-0.43 4.401 1.64 1.276-0.355 2.645-0.532 4.005-0.539 1.359 0.006 2.729 0.184 4.008 0.539 3.054-2.070 4.395-1.64 4.395-1.64 0.871 2.204 0.323 3.831 0.157 4.234 1.026 1.12 1.647 2.548 1.647 4.295 0 6.145-3.743 7.498-7.306 7.895 0.574 0.497 1.085 1.47 1.085 2.963 0 2.141-0.019 3.864-0.019 4.391 0 0.426 0.288 0.925 1.099 0.768 6.354-2.118 10.933-8.113 10.933-15.18 0-8.837-7.164-16-16-16z"></path>
            </svg>
        </a>

        <a href="tencent://message/?uin=1045674971"
           title="1045674971"
           target="_blank"
           class="user__site" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M4.821 14.393c-0.125-0.304-0.143-0.607-0.143-0.929 0-0.5 0.321-1.304 0.625-1.679-0.018-0.464 0.179-1.411 0.536-1.714 0-3.304 2.554-7.464 5.536-8.893 1.839-0.875 3.768-1.179 5.786-1.179 1.571 0 3.286 0.375 4.75 0.982 4.196 1.768 5.143 5.054 6.036 9.25l0.018 0.089c0.518 0.786 0.982 1.714 0.982 2.679 0 0.482-0.321 0.964-0.321 1.393 0 0.036 0.107 0.179 0.125 0.214 1.536 2.268 2.929 4.732 2.929 7.554 0 0.625-0.339 2.804-1.339 2.804-0.696 0-1.464-1.696-1.714-2.161-0.018-0.018-0.036-0.018-0.054-0.018l-0.089 0.071c-0.571 1.482-1.196 2.875-2.357 3.982 1.018 0.982 2.661 0.893 2.964 2.589-0.089 0.196-0.054 0.411-0.196 0.607-1.018 1.536-3.75 1.732-5.393 1.732-2.179 0-3.946-0.571-6-1.179-0.429-0.125-1.071-0.054-1.536-0.107-1.089 1.196-3.75 1.518-5.286 1.518-1.357 0-6.607-0.089-6.607-2.411 0-1 0.214-1.286 0.911-1.929 0.554-0.107 0.964-0.411 1.607-0.446 0.089 0 0.161-0.018 0.25-0.036 0.018-0.018 0.036-0.018 0.036-0.071l-0.036-0.054c-1.232-0.286-2.964-3.393-3.232-4.679l-0.089-0.054c-0.125 0-0.179 0.268-0.214 0.357-0.393 0.911-1.321 1.893-2.357 2h-0.018c-0.143 0-0.089-0.143-0.196-0.179-0.25-0.589-0.411-1.125-0.411-1.786 0-3.571 1.714-6.214 4.5-8.321z"></path>
            </svg>
        </a>
        </main>
    </div>


        <div class="module item">
            <header class="module__header">标签</header>
            <main class="module__content--three module__content fn__clear">
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/acm"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="76 篇文章">
                        acm</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="59 篇文章">
                        知识点总结</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/Java"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="29 篇文章">
                        Java</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="24 篇文章">
                        学习笔记</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E7%A8%8B"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="23 篇文章">
                        软件教程</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/STL"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="20 篇文章">
                        STL</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/DP"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="15 篇文章">
                        DP</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/windows"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="15 篇文章">
                        windows</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/Shadowsocks"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="13 篇文章">
                        Shadowsocks</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/ss"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="13 篇文章">
                        ss</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E5%89%8D%E7%AB%AF"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="9 篇文章">
                        前端</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/Linux"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="7 篇文章">
                        Linux</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E6%A0%91"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="6 篇文章">
                        树</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E6%95%B0%E5%AD%A6%E9%97%AE%E9%A2%98"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="5 篇文章">
                        数学问题</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E7%94%9F%E6%B4%BB%E8%BD%A8%E8%BF%B9"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="5 篇文章">
                        生活轨迹</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E6%A8%A1%E6%8B%9F"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="5 篇文章">
                        模拟</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="3 篇文章">
                        字符串</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E9%80%92%E5%BD%92"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="3 篇文章">
                        递归</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/python"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="3 篇文章">
                        python</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E5%9B%BE"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="3 篇文章">
                        图</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E5%BC%80%E6%BA%90"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="2 篇文章">
                        开源</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E6%B0%B4%E9%A2%98"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="2 篇文章">
                        水题</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/centos"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="2 篇文章">
                        centos</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E9%80%92%E6%8E%A8"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="2 篇文章">
                        递推</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E8%B5%84%E6%BA%90%E6%90%9C%E7%B4%A2"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 篇文章">
                        资源搜索</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E5%9B%BE%E5%BA%8A"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 篇文章">
                        图床</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/GitHub"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 篇文章">
                        GitHub</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/NOSQL"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 篇文章">
                        NOSQL</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/html"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 篇文章">
                        html</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/dfs"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 篇文章">
                        dfs</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E7%A1%AC%E4%BB%B6"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 篇文章">
                        硬件</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 篇文章">
                        数据库</a>
                    <a rel="tag"
                       href="https://Rainsheep.github.io/tags/bfs"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 篇文章">
                        bfs</a>
            </main>
        </div>

    <div class="module item">
        <div class="module__header">
            <div class="fn__flex">
                <a href="https://Rainsheep.github.io/archives.html" class="fn__flex-1 ft__center">
                    211
                    文章
                </a>
            </div>
            <br/>
            <div class="fn__flex">
                <div class="fn__flex-1 ft__center">
                    <span data-uvstaturl="https://Rainsheep.github.io">3369</span> <span class="ft-gray">浏览</span>
                </div>
            </div>
        </div>
    </div>
</aside>
    
</div>
</div>
<div class="icon__up" onclick="Util.goTop()"></div>
<footer class="footer">
    &copy; 2020
    <a href="https://Rainsheep.github.io">雨羊的个人博客</a>
    <a href="http://www.beian.miit.gov.cn/" rel="noopener nofollow" target="_blank">豫ICP备19042440号</a>
    <div class="fn__none"></div>
    <br/>

    Powered by <a href="https://solo.b3log.org" target="_blank">Solo</a>
    <div class="fn__none"></div>
    &nbsp; &heartsuit;  &nbsp;
    Theme nijigen
    <sup>[<a href="https://github.com/ZEROKISEKI/hexo-theme-gal" target="_blank">ref</a>]</sup>
    by <a href="http://vanessa.b3log.org" target="_blank">Vanessa</a>
</footer>
<div class="icon-up" onclick="Util.goTop()"></div>

<script>
  var Label = {
    servePath: "https://Rainsheep.github.io",
    staticServePath: "https://cdn.jsdelivr.net/gh/88250/solo/src/main/resources",
    luteAvailable: true,
    hljsStyle: 'github',
    langLabel: "zh_CN",
    version: "3.9.0",
    staticSite: true,
    showCodeBlockLn: false,
  }
</script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/88250/solo/src/main/resources/skins/nijigen/js/common.min.js?1584471619574" charset="utf-8"></script>


<script type="text/javascript">
    Util.addScript('https://cdn.jsdelivr.net/gh/88250/solo/src/main/resources/js/page.min.js?1584471619574', 'soloPageScript')
    var page = new Page({
        "commentContentCannotEmptyLabel": "评论内容只能为 2 到 500 个字符！",
        "oId": "1583653357274",
        "blogHost": "https://Rainsheep.github.io",
        "randomArticles1Label": "随机阅读：",
        "externalRelevantArticles1Label": "站外相关阅读："
    });
    $(document).ready(function () {
        page.load();
    page.tips.externalRelevantArticlesDisplayCount = "0";
    Skin.initArticle()
    });
</script>

</body>
</html>

<!-- Generated by Latke (https://github.com/88250/latke) in 174ms, 2020/03/18 19:04:10 -->